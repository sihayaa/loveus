<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Our Scrapbook Story</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b0f2f;       /* midnight blue */
  --paper:#f7eddc;    /* parchment */
  --ink:#0d2a6b;      /* dark blue ink */
  --accent:#7a5af8;
  --mint:#67e4ca;
  --font:"Dancing Script", cursive;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  display:flex; align-items:center; justify-content:center; overflow:hidden;
  font-family:var(--font);
}

/* Stage & book */
#stage{ width:1000px; height:650px; position:relative; perspective:1600px; }
#book{ position:absolute; inset:0; }

/* Page visuals */
.page{
  width:100%; height:100%; position:relative; overflow:hidden;
  background: radial-gradient(ellipse at 50% -10%, rgba(0,0,0,.07), transparent 40%),
              var(--paper);
  border:3px solid rgba(0,0,0,.06);
  box-shadow:inset 0 0 60px rgba(0,0,0,.22);
  backface-visibility:hidden; transform:translateZ(0);
}
.page-canvas{
  position:relative; width:100%; height:100%; padding:28px;
  color:var(--ink); font-family:var(--font);
  font-size:22px; line-height:1.35;
}

/* ---------- CLOSED COVER OVERLAY ---------- */
#closedCover{
  position:absolute; inset:0; z-index:90; display:grid; place-items:center;
}
#closedCover .cover3D{
  width:1000px; height:650px; position:relative;
  transform-style:preserve-3d; transform-origin:left center;
  transition:transform .9s ease-in-out;
}
#closedCover .hard{
  position:absolute; inset:0; background:center/cover no-repeat var(--paper);
  box-shadow: 0 25px 60px rgba(0,0,0,.45), inset 0 0 120px rgba(0,0,0,.35);
  border-radius:6px;
}
/* Spine (left) */
#closedCover .spine{
  content:""; position:absolute; left:0; top:0; bottom:0; width:28px;
  background:linear-gradient(90deg, rgba(0,0,0,.45), rgba(0,0,0,.15) 40%, rgba(255,255,255,.1));
  border-top-left-radius:6px; border-bottom-left-radius:6px;
}
/* Page-edge shimmer (right & bottom) */
#closedCover .edges::before, #closedCover .edges::after{
  content:""; position:absolute; pointer-events:none;
}
#closedCover .edges::before{
  right:0; top:12px; width:20px; height:calc(100% - 24px);
  background:linear-gradient(90deg, rgba(255,255,255,.65), rgba(180,170,150,.45));
  border-top-right-radius:6px; border-bottom-right-radius:6px;
  filter:blur(0.4px);
}
#closedCover .edges::after{
  left:18px; right:18px; bottom:0; height:16px;
  background:radial-gradient(ellipse at 50% 0%, rgba(0,0,0,.38), transparent 60%);
  border-bottom-left-radius:6px; border-bottom-right-radius:6px;
}

#closedCover.opening .cover3D{
  transform:rotateY(-120deg);
}

/* -------------- Edit items -------------- */
.scrap-item{ position:absolute; user-select:none; cursor:default; transform-origin:center center; }
.scrap-text{ background:transparent; border:0; padding:0; color:inherit; font:inherit; white-space:pre-wrap; }
.scrap-text[contenteditable="true"]{ outline:none; }
.scrap-img{ display:block; max-width:100%; max-height:100%; border:0; border-radius:0; box-shadow:none; pointer-events:none; }
.resizer{ display:none; }
.rotator{
  display:none; position:absolute; left:50%; top:-18px; transform:translate(-50%,-50%);
  width:18px; height:18px; border-radius:50%; background:#fff; border:3px solid var(--accent);
  box-shadow:0 2px 8px rgba(0,0,0,.25); cursor:grab;
}
.rotator:active{ cursor:grabbing; }

body.editing .scrap-item{ cursor:move; }
body.editing .scrap-item.selected{ box-shadow:0 0 0 3px var(--accent); }
body.editing .scrap-text{ background:rgba(255,255,255,.55); padding:10px 12px; border:1px solid rgba(0,0,0,.1); border-radius:8px; }
body.editing .scrap-img{ border:6px solid #fff; border-radius:8px; box-shadow:4px 6px 18px rgba(0,0,0,.25); }
body.editing .scrap-item .resizer{ display:block; position:absolute; right:-6px; bottom:-6px; width:16px; height:16px; border-radius:4px; background:var(--mint); border:2px solid #0b2c28; cursor:nwse-resize; }
body.editing .scrap-item .rotator{ display:block; }

/* Disable flip capture while editing; keep canvases interactive */
body.editing .stf__block, body.editing .stf__item, body.editing .stf__wrapper{ pointer-events:none !important; }
body.editing .page-canvas, body.editing .scrap-item{ pointer-events:auto !important; }

/* Toolbar */
#toolbar{
  position:absolute; left:50%; bottom:14px; transform:translateX(-50%);
  display:none; z-index:60; background:rgba(255,255,255,.92);
  border:2px solid #e8dcc6; border-radius:14px; padding:10px; gap:8px;
  box-shadow:0 10px 22px rgba(0,0,0,.25); align-items:center; flex-wrap:wrap;
}
#toolbar button{
  border:0; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700; color:#fff; background:var(--accent);
}
#toolbar button.secondary{ background:#5d47d4; }
#toolbar button.mint{ background:var(--mint); color:#022d2c; }
#toolbar button.warn{ background:#ff9aa2; color:#4c0a17; }
#toolbar .group{ display:flex; gap:8px; align-items:center; }
#fileInput{ display:none; }

/* Modals */
.modal{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; z-index:70; background:rgba(0,0,0,.55); }
.modal.open{ display:flex; }
.modal-card{ width:min(96%,560px); background:#151a30; color:#fff; border:2px solid var(--mint); border-radius:14px; padding:16px; box-shadow:0 20px 40px rgba(0,0,0,.45); }
.modal-card h3{ margin:0 0 10px; font-size:20px; }
#textModal textarea{ width:100%; background:#0f1430; color:#fff; border:1px solid #2b3258; border-radius:10px; padding:10px 12px; font-family:var(--font); font-size:20px; resize:vertical; }
.modal-actions{ margin-top:12px; display:flex; justify-content:flex-end; gap:8px; }
.modal-actions button{ border:0; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700; }
.btn-mint{ background:var(--mint); color:#05201f; }
.btn-ghost{ background:#2a315d; color:#fff; }

/* Stickers grid */
.stickers{ display:grid; grid-template-columns:repeat(6,1fr); gap:10px; }
.stickers button{ background:#0f1430; border:1px solid #2b3258; border-radius:10px; padding:8px; cursor:pointer; }
.stickers img{ width:100%; aspect-ratio:1; object-fit:contain; }

#toast{ position:absolute; top:12px; right:12px; z-index:95; background:#11172f; color:#fff; border:2px solid var(--mint); padding:8px 12px; border-radius:10px; display:none; }
.page-canvas.active-side{ outline:3px dashed var(--accent); outline-offset:-12px; }
</style>
</head>
<body>

<div id="stage">
  <!-- CLOSED COVER OVERLAY -->
  <div id="closedCover" title="Drag or click to open">
    <div class="cover3D">
      <div class="hard edges" id="coverImage"></div>
      <div class="spine"></div>
    </div>
  </div>

  <!-- Flipbook -->
  <div id="book">
    <!-- page 0 (hard cover too) -->
    <div class="page"><div class="page-canvas"></div></div>
    <!-- inner pages -->
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
    <div class="page"><div class="page-canvas"></div></div>
  </div>

  <!-- Toolbar (edit mode) -->
  <div id="toolbar">
    <div class="group">
      <button id="targetLeft" class="secondary">Edit Left</button>
      <button id="targetRight" class="secondary">Edit Right</button>
    </div>
    <div class="group">
      <button id="addTextBtn" class="mint">Add Text</button>
      <button id="addPhotoBtn" class="secondary">Add Photo</button>
      <button id="stickersBtn" class="secondary">Stickers</button>
      <button id="addPageBtn" class="secondary">Add Page</button>
    </div>
    <div class="group">
      <button id="deleteSelectedBtn" class="warn">Delete Selected</button>
      <button id="clearPageBtn" class="warn">Clear Page</button>
      <button id="saveBtn" class="mint">Save</button>
    </div>
    <input id="fileInput" type="file" accept="image/*" />
  </div>

  <!-- Text modal -->
  <div id="textModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Add Text</h3>
      <textarea id="textInput" rows="5" placeholder="Write something sweet…"></textarea>
      <div class="modal-actions">
        <button class="btn-ghost" id="textCancel">Cancel</button>
        <button class="btn-mint" id="textAdd">Add Text</button>
      </div>
    </div>
  </div>

  <!-- Stickers modal -->
  <div id="stickerModal" class="modal" aria-hidden="true">
    <div class="modal-card">
      <h3>Pick a sticker</h3>
      <div class="stickers" id="stickersGrid"></div>
      <div class="modal-actions">
        <button class="btn-ghost" id="stickersClose">Close</button>
      </div>
    </div>
  </div>

  <div id="toast">Edit mode unlocked ✨</div>
</div>

<!-- keep this file at ./flipbook/page-flip.browser.js -->
<script src="./flipbook/page-flip.browser.js"></script>
<script>
/* ------------ Config ------------- */
const PASSCODE    = '123';
const STORAGE_KEY = 'scrapbook_v8';
const COVER_URL   = 'https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/lovestory_cover.png';

/* ------------ Elements ------------- */
const bookEl    = document.getElementById('book');
const coverUI   = document.getElementById('closedCover');
const coverImage= document.getElementById('coverImage');
const toolbar   = document.getElementById('toolbar');
const toast     = document.getElementById('toast');
const fileInput = document.getElementById('fileInput');
const targetLeftBtn  = document.getElementById('targetLeft');
const targetRightBtn = document.getElementById('targetRight');

const textModal = document.getElementById('textModal');
const textInput = document.getElementById('textInput');
const textAdd   = document.getElementById('textAdd');
const textCancel= document.getElementById('textCancel');

const stickerModal = document.getElementById('stickerModal');
const stickersGrid = document.getElementById('stickersGrid');
const stickersClose= document.getElementById('stickersClose');

/* ---------- Saved content first ---------- */
applySaved();

/* ---------- Flipbook init ---------- */
const pageFlip = new St.PageFlip(bookEl, {
  width: 500, height: 650,
  size: "fixed",
  showCover: true,
  drawShadow: true,
  flippingTime: 800,
  maxShadowOpacity: 0.25,
  useMouseEvents: true,
  mobileScrollSupport: false,
  startPage: 0
});
pageFlip.loadFromHTML(document.querySelectorAll('#book .page'));

/* Apply cover to overlay + to real page 0 */
function applyCoverToReal(){
  const realCover = document.querySelector('#book .page:first-child');
  if (realCover) {
    realCover.style.backgroundImage = `url('${COVER_URL}')`;
    realCover.style.backgroundSize  = 'cover';     // 'contain' if you prefer no cropping
    realCover.style.backgroundPosition = 'center';
    realCover.style.border = '0';
    realCover.style.boxShadow = 'inset 0 0 80px rgba(0,0,0,.35)';
  }
}
coverImage.style.backgroundImage = `url('${COVER_URL}')`;
applyCoverToReal();

/* ---------- Drag-only flipping (no tap flip) ---------- */
let tapStart = null;
function isTap(d, t){ return d<8 && t<300; }
bookEl.addEventListener('pointerdown',(e)=>{ tapStart={x:e.clientX,y:e.clientY,t:Date.now()}; }, true);
bookEl.addEventListener('pointerup',(e)=>{ if(!tapStart) return; const d=Math.hypot(e.clientX-tapStart.x, e.clientY-tapStart.y); const dt=Date.now()-tapStart.t; if(isTap(d,dt)){ e.preventDefault(); e.stopPropagation(); } tapStart=null; }, true);
bookEl.addEventListener('click',(e)=>{ e.preventDefault(); e.stopPropagation(); }, true);
bookEl.addEventListener('dblclick',(e)=>{ e.preventDefault(); e.stopPropagation(); }, true);

/* ---------- Closed cover animation / visibility ---------- */
function showClosedCover(){
  // Make sure the cover image is set each time we show it
  coverImage.style.backgroundImage = `url('${COVER_URL}')`;
  coverUI.style.display = 'grid';
  // reset to closed state
  coverUI.classList.remove('opening');
  // while showing closed cover, hide the flipbook to avoid any visual tearing
  bookEl.style.visibility = 'hidden';
}
function openCover(){
  // start from visible + closed; animate; after animation, hide overlay and show book
  bookEl.style.visibility = 'hidden';            // hide book during 3D turn to remove glitch
  coverUI.classList.add('opening');
  setTimeout(()=>{
    coverUI.style.display='none';
    bookEl.style.visibility = 'visible';
    try{ pageFlip.turnToPage(1); }catch(_){}
  }, 900);
}

// start with a visible closed cover
showClosedCover();

// cover UI interactions (drag or click)
let dragStart=null;
coverUI.addEventListener('pointerdown', (e)=>{ dragStart = {x:e.clientX, y:e.clientY}; });
coverUI.addEventListener('pointerup', (e)=>{
  if(!dragStart) return;
  const dx=e.clientX-dragStart.x;
  if(Math.abs(dx)>40 || isTap(Math.abs(dx), 200)) openCover();
  dragStart=null;
});
coverUI.addEventListener('click', openCover);

/* When user flips back to index 0, re-show closed cover */
if (pageFlip.on){
  pageFlip.on('flip', ()=>{
    setTimeout(()=>{
      const idx = pageFlip.getCurrentPageIndex?.() ?? 0;<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Our Love Story — Flipbook</title>
<link rel="icon" href="data:,">
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0f2f;         /* midnight blue */
    --paper:#f7eddc;      /* parchment */
    --ink:#0d2a6b;        /* dark blue ink */
    --font:"Dancing Script", cursive;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); display:flex; align-items:center; justify-content:center;
    font-family:var(--font); color:var(--ink);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    overscroll-behavior:none;
  }

  /* Stage */
  #stage{ width:1000px; height:650px; position:relative; }
  #book{
    width:1000px; height:650px; margin:0 auto; 
    -webkit-tap-highlight-color: transparent;
    touch-action: none; /* improves drag on touch */
  }

  /* A single page panel (Turn.js puts two side-by-side) */
  .page {
    width:500px; height:650px; overflow:hidden; position:relative;
    background: radial-gradient(ellipse at 50% -10%, rgba(0,0,0,.07), transparent 40%), var(--paper);
    border:3px solid rgba(0,0,0,.06);
    box-shadow:inset 0 0 60px rgba(0,0,0,.22);
  }

  /* “Hard” pages = cover/back cover */
  .hard {
    background:#121212;
    border:0;
    box-shadow: 0 25px 60px rgba(0,0,0,.45), inset 0 0 120px rgba(0,0,0,.35);
  }
  .cover, .backcover {
    background: #222;
    display:flex; align-items:center; justify-content:center;
  }
  .cover img, .backcover img {
    width:100%; height:100%; object-fit:contain; /* FIT the image (no cropping) */
    border-radius: 6px;
  }

  /* Simple content styling (optional) */
  .content{ padding:28px; font-size:22px; line-height:1.35; }
  .h1{ font-size:42px; margin:0 0 8px; }
  .muted{ opacity:.7; font-size:18px; }

  /* Help tip */
  .tip{
    position:absolute; right:12px; bottom:12px; color:#cbd2ff99; font-size:14px;
    user-select:none; pointer-events:none;
  }
</style>
</head>
<body>
  <div id="stage">
    <div id="book">
      <!-- Front cover (hard) -->
      <div class="hard page cover">
        <img alt="Cover"
             src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/lovestory_cover.png">
      </div>

      <!-- Inside front cover (soft page) -->
      <div class="page"><div class="content"></div></div>

      <!-- Page 2–3 -->
      <div class="page"><div class="content">
        <h2 class="h1">Our Story Begins</h2>
        <p class="muted">Once upon a time…</p>
      </div></div>

      <div class="page"><div class="content">
        <h2 class="h1">How We Met</h2>
        <p>We first met on an Overwatch Discord server…</p>
      </div></div>

      <!-- Add as many pages as you want; each <div class="page"> is one side -->
      <div class="page"><div class="content"></div></div>
      <div class="page"><div class="content"></div></div>
      <div class="page"><div class="content"></div></div>
      <div class="page"><div class="content"></div></div>
      <div class="page"><div class="content"></div></div>
      <div class="page"><div class="content"></div></div>

      <!-- Inside back cover (soft page) -->
      <div class="page"><div class="content"></div></div>

      <!-- Back cover (hard) -->
      <div class="hard page backcover">
        <!-- If you have a separate back image, put it here.
             For now we reuse the cover so it still looks finished. -->
        <img alt="Back Cover"
             src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/lovestory_cover.png">
      </div>
    </div>

    <div class="tip">Drag the corners to turn pages</div>
  </div>

  <!-- jQuery + Turn.js from CDNs -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>

  <script>
    $(function () {
      $('#book').turn({
        width: 1000,
        height: 650,
        autoCenter: true,
        duration: 1000,     // opening/turning speed (ms)
        gradients: true,
        acceleration: true, // GPU boost
        elevation: 200,     // shadow depth near the spine
        when: {
          // Optional: keep background sharp while dragging
          turning: function(e, page, view){ /* you could add sounds here */ }
        }
      });
    });
  </script>
</body>
</html>

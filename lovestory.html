<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Our Scrapbook Story</title>
  <script src="https://cdn.jsdelivr.net/npm/page-flip/dist/js/page-flip.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Patrick Hand', cursive;
      background: #0b0f2f; /* midnight blue */
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #scrapbook {
      width: 90vw;
      height: 90vh;
    }

    .page {
      background: #fdf6e3; /* parchment style */
      padding: 20px;
      box-sizing: border-box;
      overflow: hidden;
      position: relative;
    }

    /* Scrapbook text/images */
    .draggable {
      position: absolute;
      cursor: move;
    }

    .draggable img {
      max-width: 200px;
      border: 3px solid #fff;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      border-radius: 6px;
    }

    /* Toolbar for edit mode */
    #toolbar {
      position: fixed;
      top: 10px;
      right: 10px;
      display: none;
      background: #1a1f4a;
      color: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }

    #toolbar button {
      margin: 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #67e4ca;
      color: #0b0f2f;
      font-weight: bold;
    }

    /* Modal (themed pop-up) */
    #modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }

    #modalContent {
      background: #fdf6e3;
      padding: 20px;
      border: 4px solid #67e4ca;
      border-radius: 10px;
      min-width: 300px;
    }

    #modalContent input, #modalContent textarea {
      width: 100%;
      margin: 10px 0;
      padding: 5px;
    }

    #modalContent button {
      margin: 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .saveBtn { background: #67e4ca; color:#0b0f2f; }
    .cancelBtn { background: #e67a7a; color:white; }
  </style>
</head>
<body>

<div id="scrapbook"></div>

<!-- Toolbar (appears in edit mode) -->
<div id="toolbar">
  <button onclick="openTextModal()">Add Text</button>
  <button onclick="triggerImageUpload()">Add Photo</button>
  <input type="file" id="imageUpload" accept="image/*" style="display:none" onchange="handleImageUpload(event)">
</div>

<!-- Modal for text input -->
<div id="modal">
  <div id="modalContent">
    <h3>Add Your Text</h3>
    <textarea id="newText" rows="4" placeholder="Write something..."></textarea>
    <button class="saveBtn" onclick="addText()">Save</button>
    <button class="cancelBtn" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
  // Initialize flipbook
  const pageFlip = new St.PageFlip(document.getElementById("scrapbook"), {
    width: 400,
    height: 600,
    size: "stretch",
    maxShadowOpacity: 0.5,
    showCover: true
  });

  // Create sample pages
  const storyPages = [
    "Cover Page",
    "Page 1",
    "Page 2",
    "Page 3",
    "Page 4"
  ];

  storyPages.forEach(text => {
    const page = document.createElement("div");
    page.className = "page";
    page.innerHTML = `<h2>${text}</h2>`;
    pageFlip.loadFromHTML([page]);
  });

  // Unlock edit mode
  document.addEventListener("keydown", (e) => {
    if (e.key === "123" || e.code === "Digit1" && e.shiftKey) {
      document.getElementById("toolbar").style.display = "block";
      alert("Edit Mode Activated! âœ¨");
    }
  });

  // Themed modal controls
  function openTextModal() {
    document.getElementById("modal").style.display = "flex";
  }
  function closeModal() {
    document.getElementById("modal").style.display = "none";
  }
  function addText() {
    const txt = document.getElementById("newText").value;
    if (!txt) return;
    const textEl = document.createElement("div");
    textEl.className = "draggable";
    textEl.style.left = "50px";
    textEl.style.top = "50px";
    textEl.innerText = txt;
    textEl.style.fontSize = "20px";
    textEl.style.color = "#0b0f2f";
    textEl.contentEditable = true; // allow live edits
    document.querySelector(".page").appendChild(textEl);
    dragElement(textEl);
    document.getElementById("newText").value = "";
    closeModal();
  }

  // Upload image
  function triggerImageUpload() {
    document.getElementById("imageUpload").click();
  }

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    const img = document.createElement("img");
    img.src = URL.createObjectURL(file);
    const wrapper = document.createElement("div");
    wrapper.className = "draggable";
    wrapper.style.left = "100px";
    wrapper.style.top = "100px";
    wrapper.appendChild(img);
    document.querySelector(".page").appendChild(wrapper);
    dragElement(wrapper);
  }

  // Make elements draggable
  function dragElement(elmnt) {
    let pos1=0,pos2=0,pos3=0,pos4=0;
    elmnt.onmousedown = dragMouseDown;
    function dragMouseDown(e) {
      e = e || window.event;
      e.preventDefault();
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      document.onmousemove = elementDrag;
    }
    function elementDrag(e) {
      e = e || window.event;
      e.preventDefault();
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
      elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }
    function closeDragElement() {
      document.onmouseup = null;
      document.onmousemove = null;
    }
  }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Our Love Space</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.4/dist/umd/supabase.min.js"></script>
  <script>
    const SUPABASE_URL = "https://tmjozxcjylcxgemffnoc.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtam96eGNqeWxjeGdlbWZmbm9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNzQxMzIsImV4cCI6MjA2NzY1MDEzMn0.W3VWFN5tiPhkoVzW_iZsYIZAcWn01LL2YfdI8zBowVI";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const ALLOW = ["gokumeng48@gmail.com","micdmick@gmail.com"];
    const ROOM_KEY = "couple";

    let CURRENT_USER = null;

    (async () => {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) { location.href = "login.html"; return; }
      const email = (user.email || "").toLowerCase();
      if (!ALLOW.includes(email)) {
        await supabase.auth.signOut();
        document.body.innerHTML = "<p style='font:16px system-ui;padding:24px'>Not authorized.</p>";
        return;
      }
      CURRENT_USER = user;

      loadReminders();

      supabase
        .channel('reminders-feed')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'reminders', filter: `room_key=eq.${ROOM_KEY}` }, loadReminders)
        .subscribe();
    })();
  </script>

  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    :root{
      --quote-green:#246B3E;
      --quote-blue:#27658A;
      --quote-purple:#453299;
      --teal:#67e4ca;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: url('https://github.com/sihayaa/loveus/blob/main/ChatGPT%20Image%20May%205,%202025,%2005_04_14%20AM.png?raw=true') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      margin: 0;
      padding: 40px;
      text-align: center;
      overflow-x: hidden;
    }

    h1 {
      font-family: 'Great Vibes', cursive;
      font-size: 3.4em;
      color: white;
      text-shadow: 2px 2px 8px #8e5dd2;
      margin-bottom: 20px;
    }

    #duration-block {
      background: rgba(255, 255, 255, 0.65);
      display: inline-block;
      padding: 12px 20px;
      border-radius: 12px;
      margin-bottom: 30px;
    }

    #duration-label {
      font-family: 'Great Vibes', cursive;
      color: #111;
      font-weight: normal;
      font-size: 1.9em;
      text-shadow: 0 0 6px #4fa981, 0 0 10px #4fa981;
    }

    #duration-value {
      color: #4fa981;
      font-weight: bold;
      font-size: 1.9em;
      text-shadow:
        -1px -1px 0 #000, 1px -1px 0 #000,
        -1px  1px 0 #000, 1px  1px 0 #000,
        0 0 6px #4fa981, 0 0 10px #4fa981;
      animation: pulseGlow 2s ease-in-out infinite;
    }

    @keyframes pulseGlow {
      0%, 100% {
        text-shadow:
          -1px -1px 0 #000, 1px -1px 0 #000,
          -1px 1px 0 #000, 1px 1px 0 #000,
          0 0 4px #4fa981, 0 0 8px #4fa981;
      }
      50% {
        text-shadow:
          -1px -1px 0 #000, 1px -1px 0 #000,
          -1px 1px 0 #000, 1px 1px 0 #000,
          0 0 10px #4fa981, 0 0 18px #4fa981;
      }
    }

    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 1em;
      background-color: #a3d2ca;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    button:hover {
      background-color: #8fc6bb;
      transform: scale(1.07);
      box-shadow: 0 0 15px #fff;
    }

    .album-icon {
      position: fixed;
      left: 20px;
      width: 80px;
      height: 80px;
      background-color: #884ea0;
      border-radius: 20px;
      box-shadow: 0 0 12px #d2b4de, 4px 4px 12px rgba(0,0,0,0.3);
      padding: 6px;
      cursor: pointer;
      z-index: 10;
      transition: all 0.3s ease;
    }

    .album-icon:hover {
      transform: scale(1.07);
      box-shadow: 0 0 15px #e43fec, 0 0 25px #d2b4de, 4px 4px 12px rgba(0,0,0,0.3);
    }

    .album-icon img {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      object-fit: cover;
    }

    #timezone-box {
      position: fixed;
      top: 40px;
      right: 40px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 18px 22px;
      width: 220px;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      box-shadow: 0 0 12px #d2b4de, 4px 4px 12px rgba(0, 0, 0, 0.3);
      text-align: left;
      z-index: 5;
    }

    .tz-header {
      font-family: 'Great Vibes', cursive;
      font-size: 1.6em;
      color: #ffffff;
      text-shadow: 1px 1px 4px #8e5dd2;
      margin-bottom: 10px;
    }

    .tz-line {
      margin: 6px 0;
      font-size: 1em;
      color: #111;
      text-shadow: 0 0 3px #4a004a, 0 0 6px #4a004a, 0 0 9px #4a004a;
    }

    .tz-label {
      font-weight: bold;
      color: #111;
      text-shadow: 0 0 3px #4a004a, 0 0 6px #4a004a, 0 0 9px #4a004a;
    }

    #countdown-box {
      position: fixed;
      top: 180px;
      right: 40px;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 18px;
      width: 220px;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      box-shadow: 0 0 12px #f5b3f5, 4px 4px 12px rgba(0, 0, 0, 0.3);
      text-align: center;
      z-index: 5;
    }

    #countdown-box .count-number {
      font-size: 1.6em;
      font-weight: bold;
      color: #ffecf7;
      text-shadow: 0 0 8px #a027a0;
    }

    #countdown-box .count-label {
      font-size: 1em;
      color: #f8e5f8;
      text-shadow: 0 0 6px #a027a0;
    }

    #logout-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 1em;
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      z-index: 20;
    }

    #logout-btn:hover {
      background: rgba(255, 0, 0, 0.4);
      transform: scale(1.07);
      box-shadow: 0 0 15px #fff;
    }

    canvas#heart-canvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
      pointer-events: none;
    }

    #mood-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .quote-box{
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      max-width: min(780px, 86vw);
      padding: 16px 24px;
      border-radius: 16px;
      background: rgba(255,255,255,0.22);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.45);
      color: #fff;
      text-align: center;
      z-index: 9999;
      font-family: 'Patrick Hand', cursive;
      font-size: 26px;
      line-height: 1.3;
      letter-spacing: 0.4px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
      opacity: 0;
      transition: opacity 420ms ease, transform 420ms ease;
    }
    .quote-box.show { opacity: 1; transform: translate(-50%,-50%); }
    .quote-box.fade-out { opacity: 0; transform: translate(-50%,-48%); }

    #reminder-box {
      position: fixed;
      top: 330px;
      right: 40px;
      width: 260px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 0 12px #c6a8f7, 4px 4px 12px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.45);
      color: #fff;
      z-index: 5;
      text-align: left;
    }

    #reminder-box h3 {
      margin: 0 0 10px 0;
      font-family: 'Patrick Hand', cursive;
      font-size: 20px;
      text-shadow: 0 0 6px #a027a0;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .reminder-input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    #reminder-input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.45);
      background: rgba(255,255,255,0.9);
      color: #111;
      font-size: 14px;
      outline: none;
    }

    #add-reminder-btn {
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      background: #a3d2ca;
      cursor: pointer;
      font-size: 14px;
    }
    #add-reminder-btn:hover { background: #8fc6bb; }

    #reminder-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .reminder-item {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 26px 10px 10px;
      margin-bottom: 10px;
      border-radius: 12px;
      background: rgba(255,255,255,0.22);
      border: 1px solid rgba(255,255,255,0.45);
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
      min-height: 52px;
    }

    .reminder-item::before{
      content:"";
      position:absolute;
      left:-1px; top:0; bottom:0;
      width:4px;
      border-radius:12px 0 0 12px;
      background: var(--teal);
      box-shadow: 0 0 10px var(--teal);
    }

    .warn {
      font-size: 20px;
      line-height: 1;
      filter: drop-shadow(0 0 6px rgba(0,0,0,0.6));
      user-select: none;
    }

    .reminder-item input[type="checkbox"] {
      cursor: pointer;
      transform: scale(1.2);
    }

    .reminder-text {
      flex: 1;
      font-size: 18px;
      font-weight: 800;
      color: #fff;
      letter-spacing: 0.2px;
      -webkit-text-stroke: 0.4px #000;
      text-shadow: 0 0 5px var(--teal), 0 0 10px var(--teal);
      word-break: break-word;
    }
    .reminder-text.done{
      text-decoration: line-through;
      opacity: 0.75;
      text-shadow: 0 0 6px var(--teal);
    }

    .delete-btn{
      position: absolute;
      top: 6px;
      right: 6px;
      background: transparent;
      border: none;
      color: #ff6b6b;
      font-size: 16px;
      line-height: 1;
      cursor: pointer;
      padding: 0;
      filter: drop-shadow(0 0 3px #000);
    }
    .delete-btn:hover { transform: scale(1.08); }

    .secret-heart {
      position: fixed;
      right: 16px;
      bottom: 16px;
      font-size: 18px;
      opacity: .25;
      transition: transform .15s ease, opacity .15s ease;
      cursor: pointer;
      user-select: none;
      z-index: 9998;
    }
    .secret-heart:hover { opacity: .6; transform: scale(1.1); }
    .secret-heart:active { transform: scale(.95); }

    .secret-backdrop {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.65);
      display: grid;
      place-items: center;
      opacity: 0; pointer-events: none;
      transition: opacity .22s ease;
      z-index: 9999;
    }
    .secret-backdrop.show { opacity: 1; pointer-events: auto; }

    .secret-modal {
      width: min(92vw, 920px);
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,.35);
      overflow: hidden;
      transform: translateY(8px) scale(.985);
      opacity: 0;
      transition: transform .22s ease, opacity .22s ease;
      position: relative;
    }
    .secret-backdrop.show .secret-modal {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    .secret-close {
      position: absolute; top: 8px; right: 10px;
      font-size: 22px; line-height: 1;
      background: #fff; border: 2px solid #e43fec;
      color: #e43fec; border-radius: 999px;
      width: 34px; height: 34px; display: grid; place-items: center;
      cursor: pointer;
    }
    .secret-frame { width: 100%; height: clamp(220px, 56vw, 520px); display:block; }
  </style>
</head>
<body>
  <h1>Started Dating: October 13, 2024</h1>

  <div id="duration-block">
    <span id="duration-label">Together for: </span>
    <span id="duration-value">loading...</span>
  </div>

  <br>
  <button onclick="location.href='games.html'">🎮 Mini Games</button>
  <button onclick="location.href='letters.html'">💌 Letters</button>

  <div class="album-icon" style="top: 100px;" onclick="location.href='album.html'">
    <img src="album-icon.png" alt="Album Icon">
  </div>
  <div class="album-icon" style="top: 200px;" onclick="location.href='mandarin.html'">
    <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/Mandarin.png" alt="Mandarin Icon">
  </div>
  <div class="album-icon" style="top: 300px;" onclick="location.href='chatwall.html'">
    <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/chatwallbg.png" alt="Chat Wall Icon">
  </div>
  <div class="album-icon" style="top: 400px;" onclick="location.href='doctor.html'">
    <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/doctor-icon.png" alt="Doctor Icon">
  </div>
  <div class="album-icon" style="top: 500px;" onclick="location.href='wishlist.html'">
    <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/wish-icon.png" alt="Wishlist Icon">
  </div>
  <div class="album-icon" style="top: 600px;" onclick="location.href='tracking.html'">
    <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/tracking-icon.png" alt="Tracking Icon">
  </div>

  <div id="timezone-box">
    <div class="tz-header">Time Zones</div>
    <div class="tz-line"><span class="tz-label">🌆 Las Vegas:</span> <span id="vegas-time">loading...</span></div>
    <div class="tz-line"><span class="tz-label">🌇 Manila:</span> <span id="manila-time">loading...</span></div>
  </div>

  <div id="countdown-box">
    <div class="count-number" id="countdown-number">loading...</div>
    <div class="count-label">before</div>
    <div class="count-label">1-year anniversary</div>
  </div>

  <div id="reminder-box">
    <h3>📄 Reminders</h3>
    <div class="reminder-input-row">
      <input id="reminder-input" type="text" placeholder="Type a reminder…" maxlength="200">
      <button id="add-reminder-btn">Add</button>
    </div>
    <div id="reminder-list"></div>
  </div>

  <button id="logout-btn">🚪 Logout</button>

  <canvas id="heart-canvas"></canvas>

  <div id="mood-overlay"></div>

  <!-- Secret video trigger + modal -->
  <div class="secret-heart" id="secretHeart" title=" ">
    💚
  </div>
  <div class="secret-backdrop" id="secretBackdrop" aria-hidden="true">
    <div class="secret-modal" role="dialog" aria-modal="true" aria-label="Surprise video">
      <button class="secret-close" id="secretClose" aria-label="Close">×</button>
      <iframe
        id="secretFrame"
        class="secret-frame"
        src="https://www.youtube.com/embed/5hfmJ41hpi8?rel=0&modestbranding=1&playsinline=1"
        title="Surprise Video"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen
      ></iframe>
    </div>
  </div>

  <!-- Vegas-based date math (fixed) -->
  <script>
    const TZ = 'America/Los_Angeles';
    const MS_DAY = 24 * 60 * 60 * 1000;

    function nowInVegas() {
      return new Date(new Date().toLocaleString('en-US', { timeZone: TZ }));
    }

    function vegasMidnight(year, month0, day) {
      const local = new Date(
        new Date(`${year}-${String(month0+1).padStart(2,'0')}-${String(day).padStart(2,'0')}T00:00:00`)
          .toLocaleString('en-US', { timeZone: TZ })
      );
      return new Date(Date.UTC(local.getFullYear(), local.getMonth(), local.getDate()));
    }

    function asUTCDateOnly(d) {
      return new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    }

    function monthsAndDaysSince(startY, startM0, startD, ref = nowInVegas()) {
      let y = ref.getFullYear();
      let m0 = ref.getMonth();
      let d = ref.getDate();

      let months = (y - startY) * 12 + (m0 - startM0);
      if (d < startD) months--;

      let anchorY = startY + Math.floor((startM0 + months) / 12);
      let anchorM0 = (startM0 + months) % 12;
      if (anchorM0 < 0) { anchorM0 += 12; anchorY--; }

      const anchorUTC = vegasMidnight(anchorY, anchorM0, startD);
      const todayUTC  = asUTCDateOnly(nowInVegas());

      const days = Math.max(0, Math.floor((todayUTC - anchorUTC) / MS_DAY)); // floor = whole days only
      return { months: Math.max(months, 0), days };
    }

    function updateDurationAndCountdown() {
      const { months, days } = monthsAndDaysSince(2024, 9, 13); // Oct = 9
      const years = Math.floor(months / 12);
      const remMonths = months % 12;

      const durEl = document.getElementById('duration-value');
      if (years > 0) {
        durEl.textContent = `${years} year${years!==1?'s':''} ${remMonths} month${remMonths!==1?'s':''} ${days} day${days!==1?'s':''}`;
      } else {
        durEl.textContent = `${remMonths} month${remMonths!==1?'s':''} and ${days} day${days!==1?'s':''}`;
      }

      const todayUTC = asUTCDateOnly(nowInVegas());
      const annivUTC = vegasMidnight(2025, 9, 13);
      const diffDays = Math.max(0, Math.ceil((annivUTC - todayUTC) / MS_DAY));

      const box = document.getElementById('countdown-number');
      if (diffDays > 0) {
        box.textContent = `${diffDays} days`;
        document.querySelectorAll('.count-label')[0].textContent = 'before';
        document.querySelectorAll('.count-label')[1].textContent = '1-year anniversary';
      } else {
        box.textContent = `Happy 💖`;
        document.querySelectorAll('.count-label')[0].textContent = 'Anniversary';
        document.querySelectorAll('.count-label')[1].textContent = '';
      }
    }

    // time zone display
    function updateTimeZones() {
      const options = { hour: '2-digit', minute: '2-digit', hour12: true };
      const vegasTime = new Date().toLocaleString('en-US', { timeZone: 'America/Los_Angeles', ...options });
      const manilaTime = new Date().toLocaleString('en-PH', { timeZone: 'Asia/Manila', ...options });
      document.getElementById('vegas-time').textContent = vegasTime;
      document.getElementById('manila-time').textContent = manilaTime;
    }

    // mood overlay driven by Vegas hour
    function applyMoodOverlay() {
      const vegasTime = new Date().toLocaleString("en-US", { timeZone: "America/Los_Angeles" });
      const hour = new Date(vegasTime).getHours();
      let color;

      if (hour >= 6 && hour < 12) {
        color = 'rgba(255, 231, 214, 0.35)';
      } else if (hour >= 12 && hour < 18) {
        color = 'rgba(214, 255, 226, 0.35)';
      } else if (hour >= 18 && hour < 22) {
        color = 'rgba(232, 214, 255, 0.35)';
      } else {
        color = 'rgba(10, 15, 60, 0.30)';
      }

      document.getElementById('mood-overlay').style.background = color;
    }

    updateTimeZones();
    updateDurationAndCountdown();
    applyMoodOverlay();

    setInterval(updateTimeZones, 60000);
    setInterval(applyMoodOverlay, 60 * 60 * 1000);
  </script>

  <!-- Hearts + reminders + quotes + logout -->
  <script>
    // hearts trail
    const canvas = document.getElementById('heart-canvas');
    const ctx = canvas.getContext('2d');
    let hearts = [];

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    document.addEventListener('mousemove', e => {
      for (let i = 0; i < 3; i++) {
        hearts.push({
          x: e.clientX,
          y: e.clientY,
          size: Math.random() * 8 + 4,
          alpha: 1,
          dx: (Math.random() - 0.5) * 2,
          dy: Math.random() * -2 - 1,
        });
      }
    });

    function drawHearts() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hearts.forEach((h, i) => {
        ctx.globalAlpha = h.alpha;
        ctx.font = `${h.size}px serif`;
        ctx.fillStyle = 'pink';
        ctx.fillText('❤', h.x, h.y);
        h.x += h.dx;
        h.y += h.dy;
        h.alpha -= 0.02;
        if (h.alpha <= 0) hearts.splice(i, 1);
      });
      requestAnimationFrame(drawHearts);
    }
    drawHearts();

    document.getElementById('logout-btn').addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.href = "login.html";
    });

    // quotes
    const sweetQuotes = [
      "You make ordinary moments feel special.",
      "Your laugh is my favorite sound.",
      "I’m grateful for you every day.",
      "You’re my calm in the chaos.",
      "I love the way you care.",
      "You’re my soft place to land.",
      "Thank you for choosing me.",
      "Your smile makes everything lighter.",
      "Being with you feels like home.",
      "You’re the best part of my day.",
      "You make life taste sweeter.",
      "I cherish our quiet minutes.",
      "Every little thing with you matters.",
      "You’re my favorite comfort.",
      "I adore your kind heart.",
      "We’re a team, and we win together.",
      "You matter. Your voice matters. Your life matters.",
      "Every little victory is worth celebrating.",
      "The person you were is the reason I get to love the person you are." ,
      "You make even the dullest days shine.",
      "Your voice is my favorite comfort.",
      "I love the way you listen to me.",
      "Being around you feels effortless.",
      "You always know how to make me smile.",
      "You turn small moments into treasures.",
      "My heart feels lighter when you’re here.",
      "You’re the calm after every storm.",
      "I love how you notice the little things.",
      "Just thinking of you makes me happy."
    ];

    const romanticQuotes = [
      "In every version of my life, I find you.",
      "With you, I am home.",
      "You’re my favorite place to be.",
      "I fall for you over and over.",
      "You’re the chapter I never want to end.",
      "My heart knows your name.",
      "You are my quietest poem.",
      "You’re my always and my again.",
      "I love you more than yesterday, less than tomorrow.",
      "You’re my wish come true.",
      "You light up the in-between.",
      "Your happiness is my favorite thing to protect.",
      "Your hand fits mine like it was meant to.",
      "You’re my favorite hello.",
      "Loving you is my best habit.",
      "I love you for who you are, not just for your best days.",
      "I choose you over and over, in every version of this life."
    ];

    const supportiveQuotes = [
      "We’re a team, always.",
      "You’ve got this, and I’ve got you.",
      "I believe in you completely.",
      "You’re stronger than you think.",
      "One step at a time, together.",
      "I’m proud of how far you’ve come.",
      "Your effort matters, I see it.",
      "Breathe, you’re doing great.",
      "I trust your pace.",
      "Whatever happens, i’m here.",
      "We’ll figure it out side by side.",
      "Progress, not perfection.",
      "You are capable of so much.",
      "On hard days, lean on me.",
      "I won’t let you do this alone.",
      "Every day may not be good, but there’s something good in every day.",
      "Choose hope, even when it’s hard to find.",
      "It’s okay to rest. Resting is part of the journey.",
      "Believe in yourself a little more today than you did yesterday.",
      "You are enough.Always have been, always will be.",
      "Change doesn’t erase you, it adds depth to who you are.",
      "The past shaped you, but the present is where you shine.",
      "Change doesn’t erase you, it adds depth to who you are.",
      "You haven’t lost yourself, you’ve just grown into new parts of you.",
      "Your soul is the same, only touched by deeper colors now."
    ];

    const quoteColors = ["#246B3E","#27658A","#453299"];

    function showRandomQuote() {
      const pool = [...sweetQuotes, ...romanticQuotes, ...supportiveQuotes];
      const text = pool[Math.floor(Math.random()*pool.length)];
      const color = quoteColors[Math.floor(Math.random()*quoteColors.length)];

      const old = document.querySelector('.quote-box');
      if (old) old.remove();

      const box = document.createElement('div');
      box.className = 'quote-box';
      box.textContent = text;

      box.style.textShadow = `0 0 10px ${color}, 0 0 18px ${color}55`;
      box.style.boxShadow = `0 8px 30px ${color}55`;
      box.style.borderColor = `${color}80`;

      document.body.appendChild(box);

      requestAnimationFrame(() => box.classList.add('show'));

      const visibleMs = 5000;
      const fadeMs = 420;
      setTimeout(() => {
        box.classList.add('fade-out');
        setTimeout(() => box.remove(), fadeMs + 20);
      }, visibleMs);
    }

    document.addEventListener('click', (e) => {
      const disallow = ['BUTTON','A','IMG','CANVAS','INPUT','TEXTAREA','SELECT'];
      const blocked = e.target.closest('.album-icon, #timezone-box, #countdown-box, #reminder-box, #logout-btn');
      if (blocked) return;
      if (disallow.includes(e.target.tagName)) return;

      if (e.target === document.body || e.target.tagName === 'HTML') {
        showRandomQuote();
        return;
      }

      if (!e.target.closest('a, button, .album-icon, #timezone-box, #countdown-box, #reminder-box, #logout-btn')) {
        showRandomQuote();
      }
    });

    /* ===== Reminders logic (shared room) ===== */
    const listEl = document.getElementById('reminder-list');
    const inputEl = document.getElementById('reminder-input');
    const addBtn = document.getElementById('add-reminder-btn');

    async function loadReminders() {
      if (!CURRENT_USER) return;
      const { data, error } = await supabase
        .from('reminders')
        .select('*')
        .eq('room_key', ROOM_KEY)
        .order('created_at', { ascending: false });

      if (error) {
        console.warn('Load reminders error:', error.message);
        listEl.innerHTML = `<div style="font-size:12px;opacity:.8">Couldn’t load reminders.</div>`;
        return;
      }

      renderReminders(data || []);
    }

    function renderReminders(rows) {
      listEl.innerHTML = '';
      if (!rows.length) {
        listEl.innerHTML = `<div style="font-size:12px;opacity:.8">No reminders yet.</div>`;
        return;
      }

      rows.forEach(r => {
        const item = document.createElement('div');
        item.className = 'reminder-item';

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = !!r.done;
        cb.addEventListener('change', () => toggleDone(r.id, cb.checked));

        const warn = document.createElement('span');
        warn.className = 'warn';
        warn.textContent = '⚠️';

        const span = document.createElement('span');
        span.className = 'reminder-text' + (r.done ? ' done' : '');
        span.textContent = r.text;

        const del = document.createElement('button');
        del.className = 'delete-btn';
        del.title = 'Delete';
        del.setAttribute('aria-label','Delete reminder');
        del.innerText = '×';
        del.addEventListener('click', () => deleteReminder(r.id));

        item.appendChild(cb);
        item.appendChild(warn);
        item.appendChild(span);
        item.appendChild(del);
        listEl.appendChild(item);
      });
    }

    async function addReminder() {
      const text = (inputEl.value || '').trim();
      if (!text) return;
      if (!CURRENT_USER) return;

      inputEl.value = '';
      const { error } = await supabase.from('reminders').insert({
        room_key: ROOM_KEY,
        text,
        done: false
      });
      if (error) console.warn('Add reminder error:', error.message);
      await loadReminders();
    }

    async function toggleDone(id, done) {
      const { error } = await supabase.from('reminders').update({ done }).eq('id', id);
      if (error) console.warn('Toggle error:', error.message);
      await loadReminders();
    }

    async function deleteReminder(id) {
      const { error } = await supabase.from('reminders').delete().eq('id', id);
      if (error) console.warn('Delete error:', error.message);
      await loadReminders();
    }

    addBtn.addEventListener('click', addReminder);
    inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') addReminder(); });
  </script>

  <!-- Secret video script -->
  <script>
    (() => {
      const heart = document.getElementById('secretHeart');
      const backdrop = document.getElementById('secretBackdrop');
      const closeBtn = document.getElementById('secretClose');
      const iframe = document.getElementById('secretFrame');

      [heart, backdrop].forEach(el => el.addEventListener('click', e => e.stopPropagation(), true));
      [heart, backdrop].forEach(el => el.addEventListener('touchstart', e => e.stopPropagation(), { passive: true, capture: true }));

      let pressTimer;
      const startPress = (e) => { e.stopPropagation(); clearTimeout(pressTimer); pressTimer = setTimeout(openModal, 2000); };
      const cancelPress = (e) => { e.stopPropagation(); clearTimeout(pressTimer); };
      heart.addEventListener('mousedown', startPress);
      heart.addEventListener('touchstart', startPress, {passive:true});
      ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev => heart.addEventListener(ev, cancelPress));

      let buffer = '';
      window.addEventListener('keydown', (e) => {
        if (e.key.length === 1 && /\d/.test(e.key)) {
          buffer = (buffer + e.key).slice(-4);
          if (buffer === '1013') { openModal(); buffer=''; }
        } else if (e.key === 'Escape' && backdrop.classList.contains('show')) {
          closeModal();
        }
      });

      function openModal() {
        if (!backdrop.classList.contains('show')) {
          backdrop.classList.add('show');
          backdrop.setAttribute('aria-hidden','false');
          document.body.style.overflow = 'hidden';
          iframe.src = "https://www.youtube.com/embed/5hfmJ41hpi8?autoplay=1&rel=0&modestbranding=1&playsinline=1";
        }
      }
      function closeModal() {
        backdrop.classList.remove('show');
        backdrop.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        iframe.src = "";
      }

      backdrop.addEventListener('click', (e) => {
        if (e.target === backdrop) closeModal();
      }, true);
      closeBtn.addEventListener('click', (e)=> { e.stopPropagation(); closeModal(); });
    })();
  </script>
</body>
</html>


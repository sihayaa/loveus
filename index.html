<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>M&T</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/ChatGPT%20Image%20Nov%2019%2C%202025%2C%2002_05_51%20PM.png" type="image/png" sizes="32x32">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.4/dist/umd/supabase.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Patrick+Hand&display=swap" rel="stylesheet">


  <link rel="stylesheet" href="css/index.css">
</head>

<body>
  <h1>
    <span id="startHeart" class="title-heart" title="Open Journal" role="link" tabindex="0">ğŸ’š</span>
    Started Dating: October 13, 2024
    <span id="title-heart" class="title-heart">ğŸ’œ</span>
  </h1>

  <div id="duration-block">
    <span id="duration-label">Together for: </span>
    <span id="duration-value">loading...</span>
  </div>

  <br>

  <div id="icon-area">
    <div class="album-icon" style="top:100px;" onclick="location.href='album.html'">
      <img src="album-icon.png" alt="Album Icon">
    </div>

    <div class="album-icon" style="top:100px;left:150px;" onclick="location.href='letters.html'" title="Love Letters">
      <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/love_letters_icon.png"
           alt="Love Letters Icon"
           onerror="this.replaceWith(document.getElementById('letters-label-template').content.cloneNode(true));">
    </div>

    <div class="album-icon" style="top:200px;" onclick="location.href='doctor.html'">
      <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/doctor-icon.png" alt="Doctor Icon">
    </div>

    <div class="album-icon" style="top:200px;left:150px;" onclick="location.href='learning.html'" title="Learning">
      <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/learning.icon.png"
           alt="Learning Icon"
           onerror="this.replaceWith(document.getElementById('learning-label-template').content.cloneNode(true));">
    </div>

    <div class="album-icon" style="top:300px;left:150px;"
         onclick="window.open('https://godbrand.org/mt/','_blank')" title="Godbrand MT">
      <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/GodbrandPortrait.png"
           alt="Godbrand Website">
    </div>

    <div class="album-icon" style="top:300px;" onclick="location.href='tracking.html'">
      <img src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/tracking-icon.png" alt="Tracking Icon">
    </div>
  </div>

  <div id="timezone-box">
    <div class="tz-header">Time Zones</div>
    <div class="tz-line">
      <span class="tz-label">ğŸŒ† Las Vegas:</span>
      <span id="vegas-time" class="tz-time-main">loading...</span>
      <span id="vegas-date" class="tz-time-sub"></span>
    </div>
    <div class="tz-line">
      <span class="tz-label">ğŸŒ‡ Manila:</span>
      <span id="manila-time" class="tz-time-main">loading...</span>
      <span id="manila-date" class="tz-time-sub"></span>
    </div>
  </div>

  <div id="countdown-box">
    <div class="count-number" id="countdown-number">loading...</div>
    <div class="count-label">before</div>
    <div class="count-label">2nd-year anniversary</div>
  </div>

  <!-- QUICK CHAT MINI WALL -->
  <div id="quick-chat-shell">
    <div class="quick-chat-header">
      <div class="quick-chat-title">Mini Notes</div>
      <div class="quick-chat-sender-controls">
        <button id="quick-btn-sihaya" type="button" class="quick-sender-btn">ğŸ’š</button>
        <div id="quick-sender-switch-track">
          <div id="quick-sender-switch-thumb"></div>
        </div>
        <button id="quick-btn-godbrand" type="button" class="quick-sender-btn">ğŸ’œ</button>
        <button id="quick-master-edit-btn" type="button" class="quick-master-edit-btn" title="Edit your notes">
          ğŸª„
        </button>
      </div>
    </div>

    <!-- editing banner exists in HTML but fully hidden by CSS -->
    <div id="quick-editing-indicator">
      editing: <span id="quick-editing-preview"></span>
      <button id="quick-cancel-edit" type="button">cancel</button>
    </div>

    <div id="quick-messages"></div>

    <form id="quick-message-form" autocomplete="off">
      <input id="quick-message-input"
             type="text"
             placeholder="leave a small noteâ€¦"
             maxlength="200" />
      <button id="quick-send-btn" type="submit">Send</button>
    </form>
  </div>

  <div id="reminder-box">
    <h3>ğŸ“„ Reminders <button id="history-toggle" title="View completed reminders">History</button></h3>
    <div class="reminder-input-row">
      <input id="reminder-input" type="text" placeholder="Click to write a reminderâ€¦" maxlength="200" readonly>
      <button id="add-reminder-btn" title="Quick add using the small box">Add</button>
    </div>
    <div id="reminder-list"></div>
  </div>

  <div class="editor-backdrop" id="editorBackdrop" aria-hidden="true">
    <div class="editor-modal" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
      <h4 class="editor-title" id="editorTitle">New Reminder</h4>
      <textarea class="editor-area" id="editorArea" placeholder="Type your reminder hereâ€¦"></textarea>
      <div class="editor-actions">
        <button class="btn btn-secondary" id="editorCancel">Cancel</button>
        <button class="btn btn-primary" id="editorSave">Save</button>
      </div>
    </div>
  </div>

  <canvas id="heart-canvas" style="position:fixed;inset:0;pointer-events:none"></canvas>

  <script>
    const canvas = document.getElementById('heart-canvas');
    const ctx = canvas.getContext('2d');
    const HEART_COLORS = ['#CF27F5','#5D7EDE','#5DDE8A','#42B396'];
    let hearts = [];

    function resizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      const w = window.innerWidth;
      const h = window.innerHeight;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      canvas.width = Math.round(w * dpr);
      canvas.height = Math.round(h * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    resizeCanvas();
    window.addEventListener('resize',resizeCanvas);

    document.addEventListener('mousemove',e=>{
      for(let i=0;i<3;i++){
        hearts.push({
          x:e.clientX,
          y:e.clientY,
          size:Math.random()*8+4,
          alpha:1,
          dx:(Math.random()-0.5)*60,
          dy:-(Math.random()*60+40),
          fadePerSec:0.6,
          color:HEART_COLORS[(Math.random()*HEART_COLORS.length)|0]
        });
      }
      if(hearts.length>1500) hearts = hearts.slice(-1500);
    });

    let lastTime = 0;
    function drawHearts(ts){
      if(!lastTime) lastTime = ts;
      const dt = Math.min((ts-lastTime)/1000,0.05);
      lastTime = ts;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      for(let i=hearts.length-1;i>=0;i--){
        const h = hearts[i];
        h.x += h.dx * dt;
        h.y += h.dy * dt;
        h.alpha -= h.fadePerSec * dt;
        if(h.alpha<=0){
          hearts.splice(i,1);
          continue;
        }
        ctx.globalAlpha = h.alpha;
        ctx.fillStyle = h.color;
        ctx.font = `${h.size}px "Times New Roman","Georgia","DejaVu Serif","Noto Serif",serif`;
        ctx.textBaseline = 'middle';
        ctx.textAlign = 'center';
        ctx.fillText('â™¥',h.x,h.y);
      }
      ctx.globalAlpha = 1;
      requestAnimationFrame(drawHearts);
    }
    requestAnimationFrame(drawHearts);
  </script>

  <div id="mood-overlay"></div>

  <template id="work-schedule-label-template"><div class="icon-label">ğŸ—“<br>Schedule</div></template>
  <template id="letters-label-template"><div class="icon-label">ğŸ’Œ<br>Letters</div></template>
  <template id="learning-label-template"><div class="icon-label">âœï¸<br>Learning</div></template>
  <template id="mem-label-template"><div class="icon-label">ğŸ—ºï¸<br>Middle-Earth</div></template>

  <div class="secret-backdrop" id="secretBackdrop" aria-hidden="true">
    <div class="secret-modal" role="dialog" aria-modal="true" aria-label="Surprise video">
      <iframe
        id="secretFrame"
        class="secret-frame"
        src="about:blank"
        title="Surprise Video"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen
      ></iframe>
    </div>
  </div>

  <script>
    const TZ = 'America/Los_Angeles';
    const MS_DAY = 24*60*60*1000;

    function vegasTodayParts(){
      const fmt = new Intl.DateTimeFormat('en-CA',{timeZone:TZ,year:'numeric',month:'2-digit',day:'2-digit'});
      const parts = fmt.formatToParts(new Date());
      const y = +parts.find(p=>p.type==='year').value;
      const m = +parts.find(p=>p.type==='month').value;
      const d = +parts.find(p=>p.type==='day').value;
      return {y,m0:m-1,d};
    }

    function monthsAndDaysSince(startY,startM0,startD){
      const {y,m0,d} = vegasTodayParts();
      let months = (y-startY)*12 + (m0-startM0);
      if(d<startD) months--;

      let anchorY = startY + Math.floor((startM0+months)/12);
      let anchorM0 = (startM0+months)%12;
      if(anchorM0<0){anchorM0+=12;anchorY--;}

      const anchorUTC = Date.UTC(anchorY,anchorM0,startD);
      const todayUTC  = Date.UTC(y,m0,d);

      const days = Math.max(0,Math.floor((todayUTC-anchorUTC)/MS_DAY));
      return {months:Math.max(months,0),days};
    }

    function updateDurationAndCountdown(){
      const {months,days} = monthsAndDaysSince(2024,9,13);
      const years = Math.floor(months/12);
      const remMonths = months%12;

      const durEl = document.getElementById('duration-value');
      if(years>0){
        durEl.textContent = `${years} year${years!==1?'s':''} ${remMonths} month${remMonths!==1?'s':''} ${days} day${days!==1?'s':''}`;
      }else{
        durEl.textContent = `${remMonths} month${remMonths!==1?'s':''} and ${days} day${days!==1?'s':''}`;
      }

      const {y,m0,d} = vegasTodayParts();
      const todayUTC = Date.UTC(y,m0,d);
      const annivUTC = Date.UTC(2026,9,13);
      const diffDays = Math.max(0,Math.floor((annivUTC-todayUTC)/MS_DAY));
      document.getElementById('countdown-number').textContent = `${diffDays} days`;
    }

    function vegasTimeParts(){
      const opts = {timeZone:TZ,hour:'2-digit',minute:'2-digit',hour12:true};
      const fmt = new Intl.DateTimeFormat('en-US',opts);
      const parts = fmt.formatToParts(new Date());
      const hour = parts.find(p=>p.type==='hour')?.value || '00';
      const minute = parts.find(p=>p.type==='minute')?.value || '00';
      const dayPeriod = parts.find(p=>p.type==='dayPeriod')?.value || '';
      return {hour,minute,dayPeriod};
    }

    function updateTimeZones(){
      const now = new Date();

      function buildTz(timeZone){
        const timeFmt = new Intl.DateTimeFormat('en-US',{timeZone,hour:'2-digit',minute:'2-digit',hour12:true});
        const dateFmt = new Intl.DateTimeFormat('en-US',{timeZone,weekday:'short',month:'2-digit',day:'2-digit'});

        const timeStr = timeFmt.format(now);
        const parts = dateFmt.formatToParts(now);
        const weekday = (parts.find(p=>p.type==='weekday')?.value || '').toUpperCase();
        const month   = parts.find(p=>p.type==='month')?.value || '';
        const day     = parts.find(p=>p.type==='day')?.value || '';
        const dateStr = `(${weekday},${month}/${day})`;
        return {timeStr,dateStr};
      }

      const vegas  = buildTz('America/Los_Angeles');
      const manila = buildTz('Asia/Manila');

      document.getElementById('vegas-time').textContent  = vegas.timeStr;
      document.getElementById('vegas-date').textContent  = vegas.dateStr;
      document.getElementById('manila-time').textContent = manila.timeStr;
      document.getElementById('manila-date').textContent = manila.dateStr;
    }

    function applyMoodOverlay(){
      try{
        const {hour:hStr,dayPeriod} = vegasTimeParts();
        let hour = parseInt(hStr,10);
        if(Number.isNaN(hour)) hour = 0;

        if(dayPeriod && /pm/i.test(dayPeriod) && hour<12) hour += 12;
        if(dayPeriod && /am/i.test(dayPeriod) && hour===12) hour = 0;

        let color;
        if(hour>=6 && hour<12)      color = 'rgba(255, 231, 214, 0.35)';
        else if(hour>=12 && hour<18)color = 'rgba(214, 255, 226, 0.35)';
        else if(hour>=18 && hour<22)color = 'rgba(232, 214, 255, 0.35)';
        else                        color = 'rgba(10, 15, 60, 0.30)';

        document.getElementById('mood-overlay').style.background = color;
      }catch(err){
        console.warn('applyMoodOverlay error',err);
      }
    }

    updateTimeZones();
    updateDurationAndCountdown();
    applyMoodOverlay();
    setInterval(updateTimeZones,60000);
    setInterval(applyMoodOverlay,60*60*1000);
  </script>

  <script>
    (() => {
      const backdrop = document.getElementById('secretBackdrop');
      const iframe   = document.getElementById('secretFrame');
      const YT_ID    = "HJyvMmyQOYQ";

      let buffer = '';
      window.addEventListener('keydown',(e)=>{
        if(e.key.length===1 && /\d/.test(e.key)){
          buffer = (buffer + e.key).slice(-4);
          if(buffer==='1013'){ openModal(); buffer=''; }
        }else if(e.key==='Escape' && backdrop.classList.contains('show')){
          closeModal();
        }
      });

      function openModal(){
        if(!backdrop.classList.contains('show')){
          document.querySelectorAll('.quote-box').forEach(el=>el.remove());
          window.QUOTES_DISABLED = true;

          backdrop.classList.add('show');
          backdrop.setAttribute('aria-hidden','false');
          document.body.style.overflow = 'hidden';
          iframe.src = `https://www.youtube.com/embed/${YT_ID}?autoplay=1&rel=0&modestbranding=1&playsinline=1`;
        }
      }
      function closeModal(){
        backdrop.classList.remove('show');
        backdrop.setAttribute('aria-hidden','true');
        document.body.style.overflow = '';
        iframe.src = "about:blank";
        window.QUOTES_DISABLED = false;
      }

      backdrop.addEventListener('click',(e)=>{
        if(e.target===backdrop) closeModal();
      },true);
    })();
  </script>

  <script>
    (() => {
      const heartEl = document.getElementById('title-heart');
      if(!heartEl) return;

      const HOLD_MS = 3000;
      let holdTimer = null;

      const startHold = (e)=>{
        e.preventDefault();
        e.stopPropagation();
        clearTimeout(holdTimer);
        holdTimer = setTimeout(()=>{ window.location.href='story.html'; },HOLD_MS);
      };

      const cancelHold = (e)=>{
        if(e) e.stopPropagation();
        clearTimeout(holdTimer);
        holdTimer = null;
      };

      heartEl.addEventListener('pointerdown',startHold,{passive:false});
      ['pointerup','pointerleave','pointercancel'].forEach(ev =>
        heartEl.addEventListener(ev,cancelHold)
      );

      heartEl.addEventListener('contextmenu',e=>{
        e.preventDefault();
        e.stopPropagation();
      });
      heartEl.addEventListener('click',e=>e.stopPropagation());
    })();
  </script>

  <script>
    (() => {
      const start = document.getElementById('startHeart');
      if(!start) return;
      const go = ()=>{ window.location.href='journal.html'; };
      start.addEventListener('click',e=>{ e.stopPropagation(); go(); });
      start.addEventListener('keydown',e=>{
        if(e.key==='Enter' || e.key===' '){
          e.preventDefault();
          e.stopPropagation();
          go();
        }
      });
    })();
  </script>

  <script src="js/quotes.js"></script>
  <script src="js/reminders.js"></script>
  <script src="js/quick-chat.js"></script>
  <script src="js/supabase-init.js"></script>
</body>
</html>

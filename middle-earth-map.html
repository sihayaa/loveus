<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Middle-earth Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=IM+Fell+English:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#1a140f; --ink:#d7c6a3; --ring:#bfa35a;
      --shadow:0 18px 55px rgba(0,0,0,.5), inset 0 1px 0 rgba(255,255,255,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; overflow:hidden; user-select:none;
      background: radial-gradient(1200px 800px at 70% 10%, #2a221b, #15100b 70%, #0d0a07 100%), var(--bg);
      color:var(--ink); font-family:"IM Fell English",serif;
    }
    #particles{position:fixed; inset:0; z-index:0; pointer-events:none}

    .topbar{
      position:fixed; inset:12px 12px auto 12px; z-index:5;
      display:flex; align-items:center; gap:12px; width:calc(100% - 24px);
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border:1px solid rgba(191,163,90,.5);
      border-radius:10px; background:rgba(32,26,20,.6); color:var(--ink);
      box-shadow:var(--shadow); backdrop-filter:blur(3px); cursor:pointer; text-decoration:none; font-size:13px;
    }
    .chip:hover{background:rgba(50,40,30,.75)}
    .title{
      flex:1; text-align:center; font-family:"Cinzel",serif; font-weight:700;
      letter-spacing:.5px; font-size:28px; text-shadow:0 0 8px rgba(255,231,160,.2);
    }

    /* smaller control drawer */
    .drawer{
      position:fixed; left:10px; bottom:10px; z-index:5;
      background:rgba(32,26,20,.8); border:1px solid rgba(191,163,90,.45);
      border-radius:10px; padding:6px 8px; display:flex; gap:8px; align-items:center; box-shadow:var(--shadow);
      backdrop-filter:blur(2px); transform-origin: left bottom;
    }
    .drawer .chip{padding:5px 9px; font-size:12px}
    .drawer label{font-size:11px; opacity:.85}
    .drawer input[type="range"]{width:120px; height:4px}

    .viewport{position:absolute; inset:64px 0 0 0; z-index:2; overflow:hidden; touch-action:none}
    .map-inner{position:absolute; top:0; left:0; transform-origin:0 0; will-change:transform}
    .map-img{
      display:block; width:100%; height:auto; pointer-events:none;
      image-rendering:auto; filter:contrast(1.02) brightness(.96) sepia(.08);
      box-shadow:var(--shadow); border-radius:4px;
    }

    .quote{
      position:fixed; z-index:4; max-width:min(70ch,90vw); left:50%; bottom:26px; transform:translateX(-50%);
      background:rgba(40,30,22,.9); border:1px solid rgba(191,163,90,.5); border-radius:14px; padding:10px 14px;
      box-shadow:var(--shadow); text-align:center; font-family:"Forte","Cinzel",serif; font-size:20px; letter-spacing:.2px;
      opacity:0; animation:fade 4.2s ease forwards;
    }
    @keyframes fade{0%{opacity:0; transform:translate(-50%,10px)}12%{opacity:1; transform:translate(-50%,0)}70%{opacity:1}100%{opacity:0; transform:translate(-50%,8px)}}
  </style>
</head>
<body>
  <canvas id="particles"></canvas>

  <div class="topbar">
    <a class="chip" href="javascript:void(0)" onclick="history.back()">‚üµ Back Home</a>
    <div class="title">MIDDLE-EARTH MAP</div>
    <a class="chip" href="#" onclick="resetView()">Reset View</a>
  </div>

  <div class="drawer">
    <label>Particles:</label>
    <button class="chip" id="modeBtn">Leaves</button>
    <label>Intensity</label>
    <input type="range" id="intensity" min="0" max="2" step="1" value="1" />
    <button class="chip" id="pauseBtn">Pause</button>
  </div>

  <div id="viewport" class="viewport">
    <div id="mapInner" class="map-inner">
      <img id="mapImg" class="map-img" alt="Map"
        src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/mem_map.png" />
    </div>
  </div>

  <script>
    // ---------- Quotes ----------
    const quotes=[
      "There and back again.","Not all those who wander are lost.",
      "Even the smallest person can change the course of the future.",
      "May it be a light for you in dark places.","The road goes ever on and on."
    ];
    function spawnQuote(){
      const q=quotes[Math.floor(Math.random()*quotes.length)];
      const el=document.createElement('div'); el.className='quote'; el.textContent=q;
      document.body.appendChild(el); setTimeout(()=>el.remove(),4200);
    }

    // ---------- Map pan/zoom ----------
    const viewport=document.getElementById('viewport');
    const mapInner=document.getElementById('mapInner');
    const mapImg=document.getElementById('mapImg');

    const FIT_FACTOR = 0.82;
    const state={scale:1,minScale:.45,maxScale:3.5,tx:0,ty:0,dragging:false,lastX:0,lastY:0,natW:1000,natH:1000};

    mapImg.addEventListener('load',()=>{ state.natW=mapImg.naturalWidth; state.natH=mapImg.naturalHeight; centerFit(); apply(); });

    function centerFit(){
      const vw=viewport.clientWidth, vh=viewport.clientHeight;
      const s=Math.min(vw/state.natW, vh/state.natH)*FIT_FACTOR;
      state.scale=s; state.tx=vw/2 - (state.natW*s)/2; state.ty=vh/2 - (state.natH*s)/2;
    }
    function apply(){ mapInner.style.transform=`translate(${state.tx}px, ${state.ty}px) scale(${state.scale})`; }
    function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

    viewport.addEventListener('pointerdown',e=>{ state.dragging=true; state.lastX=e.clientX; state.lastY=e.clientY; viewport.setPointerCapture(e.pointerId); });
    viewport.addEventListener('pointermove',e=>{
      if(!state.dragging) return;
      const dx=e.clientX-state.lastX, dy=e.clientY-state.lastY;
      state.tx+=dx; state.ty+=dy; state.lastX=e.clientX; state.lastY=e.clientY; apply();
    });
    viewport.addEventListener('pointerup',e=>{ state.dragging=false; viewport.releasePointerCapture(e.pointerId); });

    viewport.addEventListener('wheel',e=>{
      e.preventDefault();
      const factor=(e.deltaY<0)?1.08:0.92;
      const newScale=clamp(state.scale*factor, state.minScale, state.maxScale);
      zoomAt(e.clientX,e.clientY,newScale);
    },{passive:false});
    function zoomAt(cx,cy,newScale){
      const prev=state.scale; if(newScale===prev) return;
      const rect=viewport.getBoundingClientRect();
      const x=(cx-rect.left-state.tx)/prev; const y=(cy-rect.top-state.ty)/prev;
      state.tx=cx-rect.left - x*newScale; state.ty=cy-rect.top - y*newScale;
      state.scale=newScale; apply();
    }
    function resetView(){ centerFit(); apply(); }
    viewport.addEventListener('dblclick', resetView);

    let moved=false;
    viewport.addEventListener('pointerdown',()=>{moved=false;});
    viewport.addEventListener('pointermove',()=>{moved=true;});
    viewport.addEventListener('click',e=>{ if(moved) return; if(e.target.closest('.chip')) return; spawnQuote(); });
    window.addEventListener('resize',()=>{ centerFit(); apply(); });

    // ---------- Particles: Leaves / Glyphs / Runes / Embers ----------
    const palette = { gold:"#d4af37", ember:"rgba(255,140,60,.9)", leaf:"#b6a47a" };
    const MODES = ["leaves","glyphs","runes","embers"];
    const LABEL = { leaves:"Leaves", glyphs:"Glyphs", runes:"Runes", embers:"Embers" };
    let mode="leaves";

    const modeBtn=document.getElementById('modeBtn');
    const pauseBtn=document.getElementById('pauseBtn');
    const intensitySlider=document.getElementById('intensity');
    let intensity=1, paused=false;

    modeBtn.onclick=()=>{ mode = MODES[(MODES.indexOf(mode)+1)%MODES.length]; modeBtn.textContent = LABEL[mode]; seed(); };
    pauseBtn.onclick=()=>{ paused=!paused; pauseBtn.textContent=paused?'Resume':'Pause'; };
    intensitySlider.oninput=e=>{ intensity=+e.target.value; seed(); };

    const canvas=document.getElementById('particles'), ctx=canvas.getContext('2d');
    let W=0,H=0; function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; seed(); } addEventListener('resize',resize); resize();

    // density/sizes per intensity (tuned)
    const DENSITY={ leaves:[80,140,220], glyphs:[90,160,240], runes:[80,150,220], embers:[140,240,420] };
    const SIZE   ={ leaves:[7,10,14],  glyphs:[8,12,16],   runes:[8,12,16],   embers:[2,3,4] };
    const SPEEDY ={ leaves:[0.35,0.5,0.7], glyphs:[0.28,0.4,0.55], runes:[0.28,0.4,0.55], embers:[-0.9,-1.1,-1.3] }; // embers float up

    let parts=[];
    function seed(){
      const n = DENSITY[mode][intensity];
      parts.length=0;
      for(let i=0;i<n;i++) parts.push(makeP(Math.random()*W, Math.random()*H));
    }

    function makeP(x,y){
      return {
        x, y,
        vx:(Math.random()-0.5)* (mode==='embers' ? 0.25 : 0.18),
        vy: SPEEDY[mode][intensity] + (mode==='embers' ? Math.random()*-0.3 : Math.random()*0.35),
        s: SIZE[mode][intensity] * (0.9 + Math.random()*0.6),
        a: 0.55 + Math.random()*0.45,
        rot: Math.random()*Math.PI*2,
        rv: (Math.random()-0.5) * 0.02,
        kind: (Math.random()*4|0) // subtype for variety
      };
    }

    function drawLeaf(x,y,r,rot,alpha){
      ctx.save();
      ctx.translate(x,y); ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      ctx.fillStyle = palette.leaf;
      ctx.beginPath();
      ctx.moveTo(0,-r);
      ctx.quadraticCurveTo(r*0.9, -r*0.2, 0, r);
      ctx.quadraticCurveTo(-r*0.9, -r*0.2, 0, -r);
      ctx.fill();
      // vein
      ctx.strokeStyle="rgba(0,0,0,0.25)";
      ctx.lineWidth = 0.8;
      ctx.beginPath(); ctx.moveTo(0,-r*0.6); ctx.lineTo(0,r*0.7); ctx.stroke();
      ctx.restore();
    }

    function drawStar(x,y,r,rot,alpha){
      ctx.save();
      ctx.translate(x,y); ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      ctx.strokeStyle = palette.gold; ctx.lineWidth = 1.2;
      ctx.beginPath();
      for(let i=0;i<8;i++){
        const a=i*Math.PI/4;
        ctx.moveTo(0,0);
        ctx.lineTo(Math.cos(a)*r, Math.sin(a)*r);
      }
      ctx.stroke();
      ctx.restore();
    }

    function drawRune(x,y,r,rot,alpha,kind){
      ctx.save();
      ctx.translate(x,y); ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      ctx.strokeStyle = palette.gold; ctx.lineWidth = 1.2; ctx.lineCap="round";
      ctx.beginPath();
      // a few simple futhark-ish shapes
      if(kind===0){ // Fehu-ish
        ctx.moveTo(-r*0.6, -r); ctx.lineTo(-r*0.6, r);
        ctx.moveTo(-r*0.6, -r*0.4); ctx.lineTo(0, -r*0.9);
        ctx.moveTo(-r*0.6,  0);    ctx.lineTo(0, -r*0.5);
      }else if(kind===1){ // Raido-ish
        ctx.moveTo(-r*0.6, -r); ctx.lineTo(-r*0.6, r);
        ctx.moveTo(-r*0.6, -r); ctx.lineTo(r*0.4, -r*0.2);
        ctx.lineTo(-r*0.6, r*0.2);
      }else if(kind===2){ // Ansuz-ish
        ctx.moveTo(-r*0.6, -r); ctx.lineTo(-r*0.6, r);
        ctx.moveTo(-r*0.6, -r*0.3); ctx.lineTo(r*0.4, -r*0.8);
        ctx.moveTo(-r*0.6,  r*0.3); ctx.lineTo(r*0.4, -r*0.2);
      }else{ // Sowilo-ish
        ctx.moveTo(-r*0.5, r*0.8); ctx.lineTo(0, r*0.2); ctx.lineTo(-r*0.5, -r*0.4); ctx.lineTo(r*0.5, -r*0.9);
      }
      ctx.stroke();
      ctx.restore();
    }

    function step(){
      requestAnimationFrame(step); if(paused) return;
      ctx.clearRect(0,0,W,H);
      for(let i=0;i<parts.length;i++){
        const p=parts[i];
        p.x += p.vx + (mode==='embers' ? Math.sin(p.y*0.01)*0.08 : Math.sin(p.y*0.002)*0.05);
        p.y += p.vy;
        p.rot += p.rv;

        // wrap
        if(mode==='embers'){ if(p.y<-12){ parts[i]=makeP(Math.random()*W, H+12); continue; } }
        else { if(p.y>H+12){ parts[i]=makeP(Math.random()*W, -12); continue; } }
        if(p.x<-12) p.x=W+12; if(p.x>W+12) p.x=-12;

        // draw by mode
        if(mode==='leaves'){ drawLeaf(p.x,p.y,p.s,p.rot,p.a); }
        else if(mode==='glyphs'){ drawStar(p.x,p.y,p.s,p.rot,p.a); }
        else if(mode==='runes'){ drawRune(p.x,p.y,p.s,p.rot,p.a,p.kind); }
        else { // embers
          ctx.save();
          ctx.globalAlpha = p.a;
          ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2);
          ctx.fillStyle=palette.ember; ctx.shadowColor=palette.ember; ctx.shadowBlur=6; ctx.fill(); ctx.shadowBlur=0;
          ctx.restore();
        }
      }
    }
    seed(); step();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Middle-earth Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=IM+Fell+English:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#1a140f; --ink:#d7c6a3; --ring:#bfa35a;
      --shadow: 0 8px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 70% 10%, #2a221b, #15100b 70%, #0d0a07 100%), var(--bg);
      color:var(--ink); font-family:"IM Fell English", serif; overflow:hidden; user-select:none;
    }
    /* particles behind everything */
    #particles{position:fixed; inset:0; z-index:0; pointer-events:none}

    /* top bar */
    .topbar{
      position:fixed; inset:12px 12px auto 12px; z-index:5;
      display:flex; align-items:center; gap:12px; width:calc(100% - 24px);
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border:1px solid rgba(191,163,90,.5);
      border-radius:10px; background:rgba(32,26,20,.6); color:var(--ink);
      box-shadow:var(--shadow); backdrop-filter:blur(3px); cursor:pointer; text-decoration:none; font-size:14px;
    }
    .chip:hover{background:rgba(50,40,30,.75)}
    .title{
      flex:1; text-align:center; font-family:"Cinzel", serif; font-weight:700;
      letter-spacing:.5px; font-size:28px; text-shadow:0 0 8px rgba(255,231,160,.2);
    }

    /* controls drawer */
    .drawer{
      position:fixed; left:12px; bottom:12px; z-index:5;
      background:rgba(32,26,20,.8); border:1px solid rgba(191,163,90,.45);
      border-radius:12px; padding:10px; display:flex; gap:10px; align-items:center; box-shadow:var(--shadow);
      backdrop-filter:blur(3px);
    }
    .drawer label{font-size:12px; opacity:.85}
    .drawer input[type="range"]{width:140px}

    /* viewport + map */
    .viewport{position:absolute; inset:64px 0 0 0; z-index:2; overflow:hidden; touch-action:none;}
    .map-inner{position:absolute; top:50%; left:50%; transform-origin:0 0; will-change:transform;}
    .map-img{display:block; width:100%; height:auto; pointer-events:none; filter:contrast(1.02) brightness(.96) sepia(.08)}

    /* quotes (Forte vibe with fallback) */
    .quote{
      position:fixed; z-index:4; max-width:min(70ch, 90vw); left:50%; bottom:26px; transform:translateX(-50%);
      background:rgba(40,30,22,.9); border:1px solid rgba(191,163,90,.5); border-radius:14px; padding:12px 16px;
      box-shadow:var(--shadow); text-align:center; font-family:"Forte","Cinzel",serif; font-size:22px; letter-spacing:.2px;
      opacity:0; animation:fade 4.2s ease forwards;
    }
    @keyframes fade{
      0%{opacity:0; transform:translate(-50%,10px)}
      12%{opacity:1; transform:translate(-50%,0)}
      70%{opacity:1}
      100%{opacity:0; transform:translate(-50%,8px)}
    }
  </style>
</head>
<body>
  <!-- particles -->
  <canvas id="particles"></canvas>

  <!-- top bar -->
  <div class="topbar">
    <a class="chip" href="javascript:void(0)" onclick="history.back()">‚üµ Back Home</a>
    <div class="title">Middle-earth Map</div>
    <a class="chip" href="#" onclick="resetView()">Reset View</a>
  </div>

  <!-- controls -->
  <div class="drawer">
    <label>Particles:</label>
    <button class="chip" id="modeBtn">Snow</button>
    <label>Intensity</label>
    <input type="range" id="intensity" min="0" max="2" step="1" value="1" />
    <button class="chip" id="pauseBtn">Pause</button>
  </div>

  <!-- map area -->
  <div id="viewport" class="viewport">
    <div id="mapInner" class="map-inner">
      <img id="mapImg" class="map-img" alt="Map"
        src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/mem_map.png" />
    </div>
  </div>

  <script>
    // ===== Quotes =====
    const quotes = [
      "There and back again.",
      "Not all those who wander are lost.",
      "Even the smallest person can change the course of the future.",
      "May it be a light for you in dark places.",
      "The road goes ever on and on."
    ];
    function spawnQuote(){
      const q = quotes[Math.floor(Math.random()*quotes.length)];
      const el = document.createElement('div'); el.className = 'quote'; el.textContent = q;
      document.body.appendChild(el); setTimeout(()=> el.remove(), 4200);
    }

    // ===== Map pan/zoom (centered, wheel zoom) =====
    const viewport = document.getElementById('viewport');
    const mapInner = document.getElementById('mapInner');
    const mapImg   = document.getElementById('mapImg');

    const state = { scale:1, minScale:0.4, maxScale:3.5, tx:0, ty:0, dragging:false, lastX:0, lastY:0, natW:1000, natH:1000 };

    mapImg.addEventListener('load', () => {
      state.natW = mapImg.naturalWidth; state.natH = mapImg.naturalHeight;
      centerFit(); applyTransform();
    });

    function centerFit(){
      const vw = viewport.clientWidth, vh = viewport.clientHeight;
      const s = Math.min(vw/state.natW, vh/state.natH) * 0.95; // fit with a small margin
      state.scale = s;
      state.tx = vw/2 - (state.natW*s)/2;
      state.ty = vh/2 - (state.natH*s)/2;
    }

    function applyTransform(){
      mapInner.style.transform = `translate(${state.tx}px, ${state.ty}px) scale(${state.scale})`;
    }

    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    // drag to pan
    viewport.addEventListener('pointerdown', (e)=>{
      state.dragging=true; state.lastX=e.clientX; state.lastY=e.clientY;
      viewport.setPointerCapture(e.pointerId);
    });
    viewport.addEventListener('pointermove', (e)=>{
      if(!state.dragging) return;
      const dx=e.clientX-state.lastX, dy=e.clientY-state.lastY;
      state.tx+=dx; state.ty+=dy; state.lastX=e.clientX; state.lastY=e.clientY; applyTransform();
    });
    viewport.addEventListener('pointerup', (e)=>{
      state.dragging=false; viewport.releasePointerCapture(e.pointerId);
    });

    // wheel to zoom (centered on cursor)
    viewport.addEventListener('wheel', (e)=>{
      e.preventDefault();
      const factor = (e.deltaY<0)? 1.1 : 0.9;
      const newScale = clamp(state.scale * factor, state.minScale, state.maxScale);
      zoomAt(e.clientX, e.clientY, newScale);
    }, {passive:false});

    function zoomAt(cx, cy, newScale){
      const prev = state.scale; if(newScale===prev) return;
      const rect = viewport.getBoundingClientRect();
      const x = (cx - rect.left - state.tx) / prev;
      const y = (cy - rect.top  - state.ty) / prev;
      state.tx = cx - rect.left - x * newScale;
      state.ty = cy - rect.top  - y * newScale;
      state.scale = newScale; applyTransform();
    }

    // double click/tap to reset + center
    function resetView(){ centerFit(); applyTransform(); }
    viewport.addEventListener('dblclick', resetView);

    // show quote when clicking empty space (not dragging)
    let clickMoved = false;
    viewport.addEventListener('pointerdown', ()=>{ clickMoved=false; });
    viewport.addEventListener('pointermove', ()=>{ clickMoved=true; });
    viewport.addEventListener('click', (e)=>{
      if(clickMoved) return;
      // ignore clicks on controls
      if (e.target.closest('.chip')) return;
      spawnQuote();
    });

    // keep centered when resizing
    window.addEventListener('resize', ()=>{ centerFit(); applyTransform(); });

    // ===== Particles (snow/embers) =====
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext('2d');
    let W=0,H=0; function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; } window.addEventListener('resize', resize); resize();

    let mode='snow', intensity=1, paused=false;
    const modeBtn=document.getElementById('modeBtn');
    const pauseBtn=document.getElementById('pauseBtn');
    const intensitySlider=document.getElementById('intensity');

    modeBtn.onclick=()=>{ mode = (mode==='snow'?'embers':'snow'); modeBtn.textContent = mode==='snow'?'Snow':'Embers'; };
    pauseBtn.onclick=()=>{ paused=!paused; pauseBtn.textContent = paused?'Resume':'Pause'; };
    intensitySlider.oninput=(e)=>{ intensity=+e.target.value; };

    const parts=[];
    function seed(n=200){ parts.length=0; for(let i=0;i<n;i++) parts.push(makeP()); }
    function makeP(){
      return { x:Math.random()*W, y:Math.random()*H, vx:(Math.random()-0.5)*0.2,
        vy: mode==='snow' ? (0.3+Math.random()*0.6) : (0.6+Math.random()*1.2),
        s: 0.7+Math.random()*1.6, a: 0.4+Math.random()*0.6 };
    }
    function step(){
      requestAnimationFrame(step);
      if(paused) return;
      const target=[120,220,420][intensity]; if(parts.length!==target){ seed(target); }
      ctx.clearRect(0,0,W,H);
      for(const p of parts){
        p.x += p.vx + (mode==='snow' ? Math.sin(p.y*0.002)*0.05 : Math.sin(p.y*0.01)*0.08);
        p.y += p.vy;
        if(p.y>H+8){ p.y=-8; p.x=Math.random()*W; }
        if(p.x<-8) p.x=W+8;
        if(p.x>W+8) p.x=-8;

        if(mode==='snow'){
          ctx.globalAlpha=p.a*.9;
          ctx.beginPath(); ctx.arc(p.x,p.y,p.s+0.6,0,Math.PI*2);
          ctx.fillStyle="rgba(255,255,255,.9)"; ctx.fill();
        }else{
          ctx.globalAlpha=p.a;
          ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2);
          ctx.fillStyle="rgba(255,200,120,.85)";
          ctx.shadowColor="rgba(255,180,80,.8)"; ctx.shadowBlur=6; ctx.fill(); ctx.shadowBlur=0;
        }
      }
      ctx.globalAlpha=1;
    }
    seed(220); step();
  </script>
</body>
</html>

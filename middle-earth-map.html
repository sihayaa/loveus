<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Middle-earth Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=IM+Fell+English:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
<style>
  :root{ --bg:#1a140f; --ink:#d7c6a3; --ring:#bfa35a; --shadow:0 18px 55px rgba(0,0,0,.5); }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; overflow:hidden; user-select:none;
    background: radial-gradient(1200px 800px at 70% 10%, #2a221b, #15100b 70%, #0d0a07 100%), var(--bg);
    color:var(--ink); font-family:"IM Fell English",serif;
  }

  /* BACKGROUND particles (behind map) */
  #particles{ position:fixed; inset:0; z-index:1; pointer-events:none }

  /* Header (kept) */
  .topbar{position:fixed; inset:12px 12px auto 12px; z-index:10; display:flex; gap:12px; align-items:center}
  .chip{display:inline-flex; align-items:center; gap:8px; padding:7px 10px; border:1px solid rgba(191,163,90,.5);
        border-radius:10px; background:rgba(32,26,20,.6); color:var(--ink); box-shadow:var(--shadow); cursor:pointer; text-decoration:none; font-size:13px}
  .title{flex:1; text-align:center; font-family:"Cinzel",serif; font-weight:700; letter-spacing:.5px; font-size:28px}

  /* Map viewer */
  .viewport{position:absolute; inset:64px 0 0 0; z-index:2; overflow:hidden; touch-action:none}
  .map-inner{position:absolute; top:0; left:0; transform-origin:0 0; will-change:transform}
  .map-img{display:block; width:100%; height:auto; pointer-events:none; filter:contrast(1.02) brightness(.96) sepia(.08); box-shadow:var(--shadow); border-radius:4px}
</style>
</head>
<body>
  <!-- background particles -->
  <canvas id="particles"></canvas>

  <!-- header -->
  <div class="topbar">
    <a class="chip" href="javascript:history.back()">‚üµ Back Home</a>
    <div class="title">MIDDLE-EARTH MAP</div>
    <a class="chip" href="#" onclick="resetView()">Reset View</a>
  </div>

  <!-- map -->
  <div id="viewport" class="viewport">
    <div id="mapInner" class="map-inner">
      <img id="mapImg" class="map-img" alt="Map"
           src="https://raw.githubusercontent.com/sihayaa/loveus/refs/heads/main/mem_map.png" />
    </div>
  </div>

<script>
/* ========= Map pan/zoom ========= */
const viewport=document.getElementById('viewport'), mapInner=document.getElementById('mapInner'), mapImg=document.getElementById('mapImg');
const FIT=0.82, S={scale:1,min:.45,max:3.5,tx:0,ty:0,drag:false,lx:0,ly:0,nw:1000,nh:1000};
mapImg.addEventListener('load',()=>{S.nw=mapImg.naturalWidth;S.nh=mapImg.naturalHeight;fit();apply();});
function fit(){const vw=viewport.clientWidth,vh=viewport.clientHeight;const s=Math.min(vw/S.nw,vh/S.nh)*FIT;S.scale=s;S.tx=vw/2-(S.nw*s)/2;S.ty=vh/2-(S.nh*s)/2;}
function apply(){mapInner.style.transform=`translate(${S.tx}px,${S.ty}px) scale(${S.scale})`;}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
viewport.addEventListener('pointerdown',e=>{S.drag=true;S.lx=e.clientX;S.ly=e.clientY;viewport.setPointerCapture(e.pointerId);});
viewport.addEventListener('pointermove',e=>{if(!S.drag)return;const dx=e.clientX-S.lx,dy=e.clientY-S.ly;S.tx+=dx;S.ty+=dy;S.lx=e.clientX;S.ly=e.clientY;apply();});
viewport.addEventListener('pointerup',e=>{S.drag=false;viewport.releasePointerCapture(e.pointerId);});
viewport.addEventListener('wheel',e=>{e.preventDefault();const f=(e.deltaY<0)?1.08:0.92;const ns=clamp(S.scale*f,S.min,S.max);const r=viewport.getBoundingClientRect();
  const x=(e.clientX-r.left-S.tx)/S.scale, y=(e.clientY-r.top-S.ty)/S.scale; S.tx=e.clientX-r.left-x*ns; S.ty=e.clientY-r.top-y*ns; S.scale=ns; apply();},{passive:false});
function resetView(){fit();apply();} window.addEventListener('resize',()=>{fit();apply();});

/* ========= Background particles (your exact logic) ========= */
const palette = { gold:"#d4af37", ember:"rgba(255,140,60,.9)", leaf:"#b6a47a" };
const glyphs  = ["‚ú∂","‚ú∑","‚ú∏","‚úπ","‚ú∫","‚úß","‚ú¶","‚ú≥"];
const runes   = ["·ö†","·ö±","·õÉ","·ö®","·õü","·õû","·öæ","·õã"];
const leaves  = ["üçÇ","üçÅ"];

const canvas=document.getElementById('particles'), ctx=canvas.getContext('2d');
let W=0,H=0;
function sizeCanvas(){ const dpr=Math.min(devicePixelRatio||1,2);
  canvas.width=Math.floor(innerWidth*dpr); canvas.height=Math.floor(innerHeight*dpr);
  canvas.style.width=innerWidth+'px'; canvas.style.height=innerHeight+'px';
  ctx.setTransform(dpr,0,0,dpr,0,0); W=innerWidth; H=innerHeight;
}
addEventListener('resize', sizeCanvas); sizeCanvas();

/* --- flakes --- */
const flakes = [];
const FLAKE_COUNT = 60;
function makeFlake() {
  const kind = Math.random();
  let type, char, color, size;
  if (kind < .34){ type='rune';  char = runes[(Math.random()*runes.length)|0];  color = palette.gold;  size = 14+Math.random()*8; }
  else if (kind < .67){ type='leaf'; char = leaves[(Math.random()*leaves.length)|0]; color = palette.leaf; size = 16+Math.random()*10; }
  else { type='ember'; char="‚Ä¢"; color = palette.ember; size = 3+Math.random()*2; }
  return {
    x: Math.random()*W, y: -20-Math.random()*H, vy: 0.4+Math.random()*0.6,
    drift: (Math.random()*0.6)+0.2, phase: Math.random()*Math.PI*2,
    rot: Math.random()*Math.PI, spin: (Math.random()-0.5)*0.02,
    type, char, color, size, alpha: type==='ember' ? 0.8 : 0.95
  };
}
for (let i=0;i<FLAKE_COUNT;i++) flakes.push(makeFlake());

/* --- bursts --- */
let bursts = [];
function burst(x,y){
  const n = 18;
  for (let i=0;i<n;i++){
    bursts.push({
      x,y, vx: Math.cos((i/n)*Math.PI*2)*(1.5+Math.random()*1.2),
      vy: Math.sin((i/n)*Math.PI*2)*(1.5+Math.random()*1.2) - 0.6,
      life: 1, char: glyphs[i%glyphs.length], size: 10+Math.random()*10
    });
  }
}
window.addEventListener('click', e => burst(e.clientX, e.clientY));

/* --- draw helpers --- */
function fontFor(px){
  return `${px}px "Noto Sans Symbols 2","Noto Sans Runic","Segoe UI Emoji","Apple Color Emoji","Noto Color Emoji","Segoe UI Symbol","Symbola","Noto Sans",serif`;
}

/* --- animation loop --- */
function step(){
  requestAnimationFrame(step);
  ctx.clearRect(0,0,W,H);

  // soft global breeze so everything moves together
  const t = performance.now() * 0.00015;
  const breeze = Math.sin(t*3) * 0.4;

  // flakes
  for (let i=0;i<flakes.length;i++){
    const f = flakes[i];
    f.phase += 0.01;
    f.x += Math.sin(f.phase)*f.drift + breeze;
    f.y += f.vy;
    f.rot += f.spin;

    // wrap
    if (f.y > H + 30) { flakes[i] = makeFlake(); flakes[i].y = -30; continue; }
    if (f.x < -30) f.x = W + 30;
    if (f.x > W + 30) f.x = -30;

    // draw
    if (f.type === 'ember'){
      ctx.save();
      ctx.globalAlpha = f.alpha;
      ctx.beginPath(); ctx.arc(f.x, f.y, f.size, 0, Math.PI*2);
      ctx.fillStyle = f.color; ctx.shadowColor = f.color; ctx.shadowBlur = 6; ctx.fill();
      ctx.shadowBlur = 0; ctx.restore();
    } else {
      ctx.save();
      ctx.translate(f.x, f.y); ctx.rotate(f.rot);
      ctx.globalAlpha = f.alpha; ctx.fillStyle = f.color;
      ctx.font = fontFor(f.size);
      ctx.textAlign = "center"; ctx.textBaseline = "middle";
      ctx.fillText(f.char, 0, 0);
      ctx.restore();
    }
  }

  // bursts
  for (let i=bursts.length-1;i>=0;i--){
    const b = bursts[i];
    b.x += b.vx; b.y += b.vy; b.vy += 0.02; // gravity
    b.life -= 0.02;
    ctx.save();
    ctx.globalAlpha = Math.max(b.life, 0);
    ctx.fillStyle = palette.gold;
    ctx.font = fontFor(b.size * (0.9 + b.life*0.6));
    ctx.textAlign="center"; ctx.textBaseline="middle";
    ctx.fillText(b.char, b.x, b.y);
    ctx.restore();
    if (b.life <= 0) bursts.splice(i,1);
  }
}
step();
</script>
</body>
</html>

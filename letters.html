<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Love Letters</title>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Great+Vibes&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* Existing styles... */
    /* Add this button style for small bottom-left edit/save */
    .edit-save-button {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: #a28dc2;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 0.9em;
      padding: 5px 12px;
      font-family: 'Patrick Hand', cursive;
      cursor: pointer;
      opacity: 0.9;
    }
    .edit-save-button:hover {
      background: #8b72aa;
    }
  </style>
</head>
<body>
  <!-- unchanged content above -->
  <script>
    // unchanged functions above...

    function showZoomedLetter(letter) {
      const overlay = document.createElement('div');
      overlay.className = 'zoom-overlay';
      overlay.onclick = e => {
        if (e.target === overlay) document.body.removeChild(overlay);
      };

      const zoomBox = document.createElement('div');
      zoomBox.className = 'zoomed-letter';
      zoomBox.onclick = e => e.stopPropagation();

      const header = document.createElement('div');
      header.className = 'letter-header';
      header.textContent = letter.to ? `To: ${letter.to}` : '';

      const text = document.createElement('div');
      text.textContent = letter.content;
      text.style.whiteSpace = 'pre-wrap';
      text.style.marginBottom = '10px';

      const footer = document.createElement('div');
      footer.className = 'letter-footer';
      footer.textContent = letter.from ? `Love, ${letter.from}` : '';

      const date = document.createElement('div');
      date.className = 'date';
      date.textContent = new Date(letter.created_at).toLocaleString();

      const editBtn = document.createElement('button');
      editBtn.className = 'edit-save-button';
      editBtn.textContent = 'Edit';

      editBtn.onclick = () => {
        zoomBox.innerHTML = '';

        const headerInput = document.createElement('input');
        headerInput.value = letter.to || '';
        headerInput.placeholder = 'To';
        headerInput.style.marginBottom = '10px';
        headerInput.style.fontSize = '1em';
        headerInput.style.width = '100%';
        headerInput.style.border = '2px dashed #a28dc2';
        headerInput.style.borderRadius = '8px';
        headerInput.style.padding = '8px';

        const textarea = document.createElement('textarea');
        textarea.value = letter.content;
        textarea.style.width = '100%';
        textarea.style.height = '160px';
        textarea.style.fontFamily = 'Patrick Hand';
        textarea.style.fontSize = '1.2em';
        textarea.style.border = '2px dashed #a28dc2';
        textarea.style.borderRadius = '8px';
        textarea.style.padding = '12px';

        const footerInput = document.createElement('input');
        footerInput.value = letter.from || '';
        footerInput.placeholder = 'Love';
        footerInput.style.marginTop = '10px';
        footerInput.style.fontSize = '1em';
        footerInput.style.width = '100%';
        footerInput.style.border = '2px dashed #a28dc2';
        footerInput.style.borderRadius = '8px';
        footerInput.style.padding = '8px';

        const saveBtn = document.createElement('button');
        saveBtn.textContent = 'Save';
        saveBtn.className = 'edit-save-button';
        saveBtn.onclick = async () => {
          const { error } = await client
            .from('letters')
            .update({ content: textarea.value, to: headerInput.value, from: footerInput.value })
            .eq('id', letter.id);
          if (!error) {
            document.body.removeChild(overlay);
            loadLetters();
          }
        };

        zoomBox.appendChild(headerInput);
        zoomBox.appendChild(textarea);
        zoomBox.appendChild(footerInput);
        zoomBox.appendChild(date);
        zoomBox.appendChild(saveBtn);
      };

      zoomBox.appendChild(header);
      zoomBox.appendChild(text);
      zoomBox.appendChild(footer);
      zoomBox.appendChild(date);
      zoomBox.appendChild(editBtn);

      overlay.appendChild(zoomBox);
      document.body.appendChild(overlay);
    }
  </script>
</body>
</html>

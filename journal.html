<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Book Journal — Blank Pages (type 123 to edit)</title>
<link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
<style>
:root{
  --pageW: 980px; --pageH: 1060px;
  --bg:#0b0f2f; --paper:#f7eddc; --ink:#0d2a6b;
  --font:"Lobster", cursive;
}
*{box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{margin:0;background:var(--bg);color:var(--ink);font-family:var(--font);display:flex;align-items:center;justify-content:center}
#stage{position:relative;width:var(--pageW);height:var(--pageH);transform-origin:center;overflow:visible}
.deck{position:absolute;inset:0;perspective:1200px}
.page{position:absolute;inset:0;background:var(--paper);border-radius:20px;border:2px solid #efe6d5;
  box-shadow:inset 0 0 60px rgba(0,0,0,.22),0 18px 40px rgba(0,0,0,.35);
  overflow:hidden;transform-origin:center;transition:transform .45s cubic-bezier(.2,.7,.2,1),opacity .45s,filter .45s;opacity:.9;filter:saturate(.95);pointer-events:none;z-index:0}
.page .page-canvas{position:relative;width:100%;height:100%;padding:32px}
.page.active{opacity:1;filter:none;pointer-events:auto;z-index:3}
.pos--2{transform:translateX(-70px) rotate(-1.2deg) scale(.95);z-index:1}
.pos--1{transform:translateX(-36px) rotate(-.6deg) scale(.975);z-index:2}
.active{transform:translateX(0) rotate(0) scale(1);z-index:3}
.pos-1{transform:translateX(36px) rotate(.6deg) scale(.975);z-index:2}
.pos-2{transform:translateX(70px) rotate(1.2deg) scale(.95);z-index:1}

/* Clean page */
.entry{position:relative; width:100%; height:100%;}
.letter-view{white-space:pre-wrap; font-size:34px; line-height:1.35; width:100%; height:100%;}

/* Editor (only when unlocked) */
.edit-only{display:none}
body.editing .edit-only{display:block}
body.editing .view-only{display:none}

.editor{position:absolute; inset:32px;}
.editor [contenteditable]{outline:none; border:0; width:100%; height:100%; padding:0; background:transparent; font:34px/1.35 var(--font); color:var(--ink);}

/* nav + add page */
.nav{position:absolute;top:50%;transform:translateY(-50%);border:0;width:56px;height:56px;border-radius:50%;cursor:pointer;z-index:10;
  background:#ffffffd8;box-shadow:0 10px 22px rgba(0,0,0,.25);font-weight:900;font-size:22px;color:#182042;display:grid;place-items:center}
.nav.left{left:-72px} .nav.right{right:-72px} .nav.disabled{opacity:.45;pointer-events:none}
.addpage{position:absolute;left:50%;bottom:-64px;transform:translateX(-50%);border:0;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:900;
  background:#ffffffd8;color:#182042;box-shadow:0 10px 22px rgba(0,0,0,.25);display:none}
body.editing .addpage{display:block}
</style>
</head>
<body>

<div id="stage">
  <div class="deck" id="deck">
    <!-- cover + 5 blank sheets to start; no back cover -->
    <div class="page cover active" data-page="1"><div class="page-canvas"></div></div>
    <div class="page" data-page="2"><div class="page-canvas"></div></div>
    <div class="page" data-page="3"><div class="page-canvas"></div></div>
    <div class="page" data-page="4"><div class="page-canvas"></div></div>
    <div class="page" data-page="5"><div class="page-canvas"></div></div>
    <div class="page" data-page="6"><div class="page-canvas"></div></div>
  </div>
  <button class="nav left"  id="prev" aria-label="Previous">◀</button>
  <button class="nav right" id="next" aria-label="Next">▶</button>
  <button class="addpage" id="addPageBtn" title="Add Page">＋ Add Page</button>
</div>

<script>
(function(){
  const PASSCODE = '123'; // type this anywhere to unlock edit mode
  const STORAGE_KEY = 'book_journal_blank_v1';

  const deck = document.getElementById('deck');
  const stage = document.getElementById('stage');
  const prevBtn=document.getElementById('prev');
  const nextBtn=document.getElementById('next');
  const addPageBtn=document.getElementById('addPageBtn');

  let current = 0; // page index
  let state = load() || makeInitial();

  // === helpers ===
  const fitStage = ()=>{
    const vw=innerWidth, vh=innerHeight, mx=200, my=40;
    const s=Math.min(1, vw/(parseInt(getComputedStyle(stage).width)+mx), vh/(parseInt(getComputedStyle(stage).height)+my));
    stage.style.transform='scale('+s+')';
  };
  addEventListener('resize', fitStage); fitStage();

  function makeInitial(){
    // cover + 5 blank pages
    return { pages: [ {kind:'cover'}, {kind:'entry', body:''}, {kind:'entry', body:''}, {kind:'entry', body:''}, {kind:'entry', body:''}, {kind:'entry', body:''} ] };
  }
  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
  function load(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)); }catch(_){ return null } }

  const getPages = ()=> Array.from(deck.querySelectorAll('.page'));
  function setClasses(){
    const pages=getPages();
    pages.forEach((p,i)=>{
      p.classList.remove('pos--2','pos--1','pos-1','pos-2','active');
      if(i===current)   p.classList.add('active');
      if(i===current-1) p.classList.add('pos--1');
      if(i===current-2) p.classList.add('pos--2');
      if(i===current+1) p.classList.add('pos-1');
      if(i===current+2) p.classList.add('pos-2');
    });
    prevBtn.classList.toggle('disabled', current===0);
  }

  function renderAll(){
    deck.innerHTML='';
    state.pages.forEach((pg,idx)=>{
      const el=document.createElement('div'); el.className='page'; if(idx===0) el.classList.add('cover');
      el.dataset.page=String(idx+1);
      el.innerHTML='<div class="page-canvas"></div>';
      deck.appendChild(el);
      if(pg.kind==='entry') buildEntry(el, pg, idx);
    });
    current = Math.min(current, state.pages.length-1);
    setClasses();
  }

  function buildEntry(pageEl, pageData, pageIdx){
    const canvas = pageEl.querySelector('.page-canvas');
    const wrap = document.createElement('div'); wrap.className='entry';
    wrap.innerHTML = `
      <div class="letter-view view-only"></div>
      <div class="editor edit-only"><div class="letter-edit" contenteditable="true" spellcheck="true"></div></div>`;
    canvas.appendChild(wrap);

    const view = wrap.querySelector('.letter-view');
    const ed   = wrap.querySelector('.letter-edit');

    const sync = ()=>{ view.textContent = pageData.body||''; ed.textContent = pageData.body||''; };
    sync();

    // autosave on edit
    ed.addEventListener('input', ()=>{ pageData.body = ed.textContent; save(); view.textContent = pageData.body; });
  }

  // add page (append at end)
  addPageBtn.addEventListener('click', ()=>{
    state.pages.push({kind:'entry', body:''});
    current = state.pages.length-1;
    renderAll();
  });

  // nav
  prevBtn.onclick = ()=>{ current=Math.max(0,current-1); setClasses(); };
  nextBtn.onclick = ()=>{ current=Math.min(state.pages.length-1,current+1); setClasses(); };

  // ===== direct passcode (type 123) =====
  let buf=''; let t=null;
  function normalizeDigit(e){
    if(e.key==='1'||e.code==='Digit1'||e.code==='Numpad1') return '1';
    if(e.key==='2'||e.code==='Digit2'||e.code==='Numpad2') return '2';
    if(e.key==='3'||e.code==='Digit3'||e.code==='Numpad3') return '3';
    return /^[0-9]$/.test(e.key)? e.key : '';
  }
  addEventListener('keydown', (e)=>{
    if(e.ctrlKey||e.metaKey||e.altKey) return; // ignore combos
    const d = normalizeDigit(e); if(!d) return;
    buf += d; clearTimeout(t); t = setTimeout(()=> buf='', 1200);
    if(buf.endsWith(PASSCODE)){
      buf=''; enterEdit();
    }
  });

  function enterEdit(){ document.body.classList.add('editing'); }

  // click on page in edit mode selects it
  deck.addEventListener('mousedown', (e)=>{
    if(!document.body.classList.contains('editing')) return;
    const pg=e.target.closest('.page'); if(!pg) return; current = getPages().indexOf(pg); setClasses();
  });

  // boot
  renderAll();
})();
</script>
</body>
</html>

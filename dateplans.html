<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Date Plans</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" href="data:,">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.43.4/dist/umd/supabase.min.js"></script>
<style>
  :root{
    --bg:#07110e; --card:#0f1a17; --ink:#eaf7f1; --muted:#a6c9bf; --line:#22332d;
    --accent:#0CFF6B; --green:#1b8f7d; --danger:#e65353; --radius:16px; --maxw:1100px;
    --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:var(--font);min-height:100svh;display:grid;place-items:center}

  .shell{width:min(100%,var(--maxw));height:min(94svh,900px);background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.55);display:grid;grid-template-rows:auto auto 1fr;overflow:hidden}
  .topbar{display:flex;align-items:center;padding:14px 18px;background:linear-gradient(90deg,#145a4f,#3f2a9e);color:#fff}
  .topbar h1{margin:0;font-size:22px}

  .controls{display:flex;flex-wrap:wrap;gap:10px;padding:12px 16px;background:#0d1815;border-top:1px solid transparent;border-bottom:1px solid var(--line)}
  input[type="date"],input[type="text"],textarea{
    height:40px;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:#12231e;color:var(--ink);outline:none
  }
  textarea{min-height:40px;height:40px;max-height:160px;resize:vertical}
  input::placeholder,textarea::placeholder{color:var(--muted)}
  .grow{flex:1 1 260px}
  .btn{border:1px solid #175e54;border-radius:12px;padding:10px 14px;height:40px;background:var(--green);color:#fff;cursor:pointer}

  .listwrap{overflow:auto;padding:0 12px 14px}
  /* simple grid header */
  .hdr,.row{display:grid;grid-template-columns:220px 320px 1fr;gap:0}
  .hdr{position:sticky;top:0;background:#0d1815;border-bottom:1px solid var(--line);z-index:3}
  .hdr div{padding:12px 14px;color:var(--muted);font-weight:700;text-transform:lowercase}
  .hdr div+div{border-left:1px solid #24423a}

  /* row container */
  .row{
    position:relative;margin-top:12px;padding:14px;border-radius:14px;
    background:#15382f;border:1px solid #2b463f;
    box-shadow:inset 0 0 0 2px rgba(12,255,107,.18);
    transition:box-shadow .15s, transform .12s, filter .12s;
  }
  .row:hover{transform:translateY(-1px);box-shadow:inset 0 0 0 2px rgba(12,255,107,.55),0 0 14px rgba(12,255,107,.12)}
  .row > div{padding:6px 10px}
  .row > div+div{border-left:1px solid #24423a}
  .label{font-size:12px;color:var(--muted);margin-bottom:6px}
  .cell input[type="text"],.cell input[type="date"],.cell textarea{width:100%}
  .notes textarea{min-height:56px}

  /* date cell: hard-left align checkbox + date */
  .date .inline{display:flex;align-items:center;gap:8px;justify-content:flex-start;width:max-content}
  .date input[type="date"]{width:170px}

  /* checklist checkbox */
  .chk{appearance:none;width:18px;height:18px;border-radius:6px;border:2px solid #2b463f;background:#0f1f1b;cursor:pointer;position:relative;outline:none}
  .chk:checked{border-color:#1f6b5e;background:#18453c}
  .chk:checked::after{content:"‚úî";position:absolute;inset:0;display:grid;place-items:center;font-size:12px;color:var(--accent)}

  /* tiny top-right tools */
  .tools{position:absolute;right:8px;top:6px;display:flex;gap:6px;opacity:.15;transition:opacity .15s}
  .row:hover .tools{opacity:.7}
  .icon{width:18px;height:18px;display:inline-grid;place-items:center;border-radius:6px;padding:0;border:1px solid transparent;background:transparent;color:var(--ink);font-size:11px;cursor:pointer}
  .icon:hover{background:#0f1f1b;border-color:#2a3d36}
  .icon.del:hover{background:#2a1a1a;border-color:#5a2a2a}

  /* done style */
  .row.done{filter:saturate(.9) brightness(.96)}
  .row.done .label{text-decoration:line-through;color:#88a79d}

  /* modal (simple) */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);display:none;place-items:center;z-index:50}
  .overlay.show{display:grid}
  .modal{width:min(96vw,720px);background:#132620;border:1px solid #285045;border-radius:16px;box-shadow:0 20px 48px rgba(0,0,0,.55);padding:16px}
  .modal h2{margin:0 0 12px 0}
  .modal .grid{display:grid;grid-template-columns:160px 1fr;gap:12px}
  .modal label{font-size:12px;color:var(--muted)}
  .modal input,.modal textarea{border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:#0f1f1b;color:var(--ink);width:100%}
  .modal textarea{min-height:120px}
  .modal .actions{margin-top:12px;display:flex;gap:10px;justify-content:flex-end}
  .ghost{background:transparent;border:1px solid #365e55;color:#dff6ee}

  @media (max-width:760px){
    .hdr,.row{grid-template-columns:1fr}
    .hdr div+div,.row > div+div{border-left:none}
  }
</style>
</head>
<body>
  <div class="shell">
    <div class="topbar"><h1>Date Plans</h1></div>

    <!-- add new -->
    <div class="controls">
      <input id="in-date" type="date" />
      <input id="in-type" type="text" class="grow" placeholder="type (movie, dinner, game night‚Ä¶)" />
      <textarea id="in-notes" class="grow" placeholder="notes (where, what you watched/played, moments, etc.)"></textarea>
      <button class="btn" id="btn-save">Save</button>
    </div>

    <!-- list -->
    <div class="listwrap">
      <div class="hdr">
        <div>date</div><div>type</div><div>notes</div>
      </div>
      <div id="rows"></div>
    </div>
  </div>

  <!-- modal -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <h2 id="editTitle">Edit Date Plan</h2>
      <div class="grid">
        <label for="m-date">Date</label><input id="m-date" type="date">
        <label for="m-type">Type</label><input id="m-type" type="text">
        <label for="m-notes">Notes</label><textarea id="m-notes"></textarea>
      </div>
      <div class="actions">
        <button class="btn ghost" id="m-cancel">‚úñÔ∏è Cancel</button>
        <button class="btn" id="m-save">‚úîÔ∏è Save</button>
      </div>
    </div>
  </div>

<script>
/* ----- utils ----- */
const $ = s => document.querySelector(s);
const rowsEl = $('#rows');

function localYYYYMMDD(d=new Date()){
  const tz = d.getTimezoneOffset()*60000;
  return new Date(d - tz).toISOString().slice(0,10);
}
$('#in-date').value = localYYYYMMDD();

function toast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  Object.assign(t.style, {position:'fixed',left:'50%',top:'10px',transform:'translateX(-50%)',background:'#000',color:'#fff',padding:'10px 14px',borderRadius:'10px',zIndex:9999,opacity:.94});
  document.body.appendChild(t); setTimeout(()=>t.remove(),1600);
}
const esc = s => String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));

/* ----- Supabase ----- */
const SUPABASE_URL  = "https://tmjozxcjylcxgemffnoc.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtam96eGNqeWxjeGdlbWZmbm9jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwNzQxMzIsImV4cCI6MjA2NzY1MDEzMn0.W3VWFN5tiPhkoVzW_iZsYIZAcWn01LL2YfdI8zBowVI";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
const TABLE = 'date_plans';

/* ----- CRUD ----- */
async function fetchAll(){
  const { data, error } = await sb.from(TABLE)
    .select('*')
    .order('date', { ascending:false })
    .order('created_at', { ascending:false });
  if (error){ console.error(error); toast('load failed'); return; }
  render(data || []);
}

async function addNew(){
  const date = $('#in-date').value;
  const type = $('#in-type').value.trim();
  const notes = $('#in-notes').value.trim();
  if (!date || !type){ toast('need date + type'); return; }
  const { error } = await sb.from(TABLE).insert({ date, type, notes });
  if (error){ console.error(error); toast('save failed'); return; }
  $('#in-notes').value = '';
}

async function updateRow(id, fields){
  const { error } = await sb.from(TABLE).update(fields).eq('id', id);
  if (error){ console.error(error); toast('save failed'); }
}

async function deleteRow(id){
  if (!confirm('delete this plan?')) return;
  const { error } = await sb.from(TABLE).delete().eq('id', id);
  if (error){ console.error(error); toast('delete failed'); }
}

/* ----- render ----- */
function rowEl(r){
  const wrap = document.createElement('div');
  wrap.className = 'row' + (r.done ? ' done' : '');
  wrap.dataset.id = r.id;

  wrap.innerHTML = `
    <div class="cell date">
      <div class="label">Date:</div>
      <div class="inline">
        <input type="checkbox" class="chk" ${r.done ? 'checked':''} aria-label="done">
        <input type="date" value="${r.date ?? ''}" disabled>
      </div>
    </div>

    <div class="cell type">
      <div class="label">Type:</div>
      <input type="text" value="${esc(r.type||'')}" disabled>
    </div>

    <div class="cell notes">
      <div class="label">Notes:</div>
      <textarea disabled>${esc(r.notes||'')}</textarea>
    </div>

    <div class="tools">
      <button class="icon edit" title="Edit">‚úçüèª</button>
      <button class="icon del"  title="Delete">üóëÔ∏è</button>
    </div>
  `;

  // events
  wrap.querySelector('.chk').addEventListener('change', async e=>{
    const done = e.target.checked;
    const id = r.id;
    const { error } = await sb.from(TABLE).update({ done }).eq('id', id);
    if (error){ console.error(error); toast('add column "done" first'); e.target.checked = !done; return; }
    wrap.classList.toggle('done', done);
  });

  wrap.querySelector('.del').addEventListener('click', ()=> deleteRow(r.id));
  wrap.querySelector('.edit').addEventListener('click', ()=> openModal(r));

  return wrap;
}

function render(list){
  rowsEl.innerHTML = '';
  list.forEach(r => rowsEl.appendChild(rowEl(r)));
}

/* ----- top controls: keyboard ----- */
const inDate = $('#in-date'), inType = $('#in-type'), inNotes = $('#in-notes'), btnSave = $('#btn-save');
[inDate,inType,inNotes,btnSave].forEach(el => el.addEventListener('keydown', e=>{
  if (e.key !== 'Enter') return;
  if (el === inNotes && e.shiftKey) return; // newline
  e.preventDefault(); addNew();
}));
btnSave.addEventListener('click', addNew);

/* ----- modal edit ----- */
const overlay = $('#overlay'), mDate=$('#m-date'), mType=$('#m-type'), mNotes=$('#m-notes'), mCancel=$('#m-cancel'), mSave=$('#m-save');
let editingId=null;
function openModal(row){
  editingId=row.id; mDate.value=row.date??''; mType.value=row.type??''; mNotes.value=row.notes??'';
  overlay.classList.add('show'); setTimeout(()=>mType.focus(),0);
}
function closeModal(){ overlay.classList.remove('show'); editingId=null; }
mCancel.addEventListener('click', closeModal);
overlay.addEventListener('click', e=>{ if(e.target===overlay) closeModal(); });
document.addEventListener('keydown', e=>{ if(e.key==='Escape'&&overlay.classList.contains('show')) closeModal(); });
[mDate,mType,mNotes,mSave].forEach(el=>el.addEventListener('keydown', e=>{
  if (e.key!=='Enter') return; if (el===mNotes && e.shiftKey) return; e.preventDefault(); doSaveModal();
}));
mSave.addEventListener('click', doSaveModal);
async function doSaveModal(){
  if (!editingId) return;
  const payload = { date: mDate.value, type: mType.value.trim(), notes: mNotes.value.trim() };
  if (!payload.date || !payload.type){ toast('need date + type'); return; }
  await updateRow(editingId, payload); closeModal();
}

/* ----- realtime + init ----- */
sb.channel('public:'+TABLE)
  .on('postgres_changes', { event:'*', schema:'public', table:TABLE }, fetchAll)
  .subscribe();

fetchAll();
</script>
</body>
</html>
